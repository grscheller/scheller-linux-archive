Purpose: To rebuild from scratch maxwell4 after
         it crashed.  Named after Leonard Euler's
         solution to the Königsberg Bridge Problem.

2021-12-04:

  Installing Arch Linux on a Dell Inspiron 15 7591 2-in-1
    - 4 core i7-10510U CPU 1.8 GHz
    - 16 GB memory
    - Realtek Audio
    - UEFI system
    - Intel(R) UHD Graphics
    - NVIDIA GeForce MX250 Graphics

  Downloaded latest ISO image on gauss17 from

    https://archlinux.org/download/

  should have

    MD5:  c8beaaea6dd5986d36dd532d1df4dc26
    SHA1: e303b93788220dbe8e0ba1804c90beebe432cf63

  With Firefox browser, I downloaded from the link

    https://mirror.rackspace.com/archlinux/iso/2021.12.01/

  the files

    archlinux-2021.12.01-x86_64.iso
    archlinux-2021.12.01-x86_64.iso.sig

  Test validity,

    $ pacman-key -v archlinux-2021.12.01-x86_64.iso.sig archlinux-2021.12.01-x86_64.iso
    ==> Checking archlinux-2021.12.01-x86_64.iso.sig... (detached)
    gpg: Signature made Wed 01 Dec 2021 07:45:16 AM MST
    gpg:                using RSA key 4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC
    gpg:                issuer "pierre@archlinux.de"
    gpg: Note: trustdb not writable
    gpg: Good signature from "Pierre Schmitz <pierre@archlinux.de>" [full]

  Compare checksums from https://archlinux.org/download/

    $ md5sum archlinux-2021.12.01-x86_64.iso
    c8beaaea6dd5986d36dd532d1df4dc26  archlinux-2021.12.01-x86_64.iso

    $ sha1sum  archlinux-2021.12.01-x86_64.iso
    e303b93788220dbe8e0ba1804c90beebe432cf63  archlinux-2021.12.01-x86_64.iso

  Got valid and the correct files.  Due diligence done!

  Put a previous thumbdrive in, last month's arch iso got "automounted"
  so un-mount it

    $ sudo umount /run/media/grs/ARCH_202111

  Image thumbdrive.

    $ sudo dd bs=4M if=archlinux-2021.12.01-x86_64.iso of=/dev/sdd
    212+1 records in
    212+1 records out
    891629568 bytes (892 MB, 850 MiB) copied, 175.509 s, 5.1 MB/s

    $ ls -l archlinux-2021.12.01-x86_64.iso
    -rw-r--r-- 1 grs grs 891629568 Dec  4 15:25 archlinux-2021.12.01-x86_64.iso

  Remove and reinsert thumbdrive.

    $ df -h
    Filesystem  Size  Used Aval Use% Mounted on
    ...
    /dev/sdd1   776M  776M    0 100% /run/media/grs/60...

  Boot what is left of maxwell4 from the thumbdrive.
  Hit <F12> on this to Dell "One-Time Boot Setting" and
  boot from "UEFI TOSHIBA" (with USB icon):

  Now at the archiso root prompt.

2021-12-04:

  The lsblk command is still showing all the nvme
  drives I created for maxwell4.  I ran fsck against

    /dev/nvme0n1p3 (/ for maxwell4)
    /dev/nvme1n1p1 (/home for maxwell4)
    /dev/nvme0n1p1 (/boot for maxwell4)

  For the last one it said only minor difference
  between primary & backup block (I forget exact
  terminology) and offered to swap in backup for
  primary.  I did so and wrote changes.

  Still broken when I tried to reboot.

2021-12-04:

  Back at the archiso root prompt.

    # iwctl device list

  One wireless device, wlan0 in station mode.

    # iwctl station wlan0 scan
    # iwctl station wlan0 get-networks
    # iwctl --passphrase <pass phrase> station wlan0 connect <SSID>

  Able to ping 1.1.1.1 and archlinux.org.  The getent command unable
  to resolve DNS for IPv4.  Don't worry about this for now.

  Next step, sync with time servers

    # timedatectl set-ntp true

  Look at what is already there

    # lsblk
    Name         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
    loop0          7:0    0 701.3M  1 loop /run/archiso/airootfs
    sda            8:0    1  14.9G  0 disk
      sda1         8:1    1   776M  0 part /run/archiso/bootmnt
      sda2         8:2    1    74M  0 part
    nvme0n1      259:0    0 476.9G  0 disk
      nvme0n1p1  259:1    0   512M  0 part
      nvme0n1p2  259:2    0  16.1G  0 part
      nvme0n1p3  259:3    0 450.3G  0 part
    nvme1n1      259:4    0  27.3G  0 disk
      nvme0n1p1  259:5    0  27.2G  0 part

  Good, no RAID things are there.  I'll keep the partitions,
  but will redo the file systems.

  Intended disk layout:

    /dev/nvme0n1p1    /boot  (fat32)
    /dev/nvme0n1p2    swap
    /dev/nvme0n1p3    /      (ext4)
    /dev/nvme1n1p1    /home  (ext4)

  Do I try and fix what I got or reinstall from scratch?
  Reinstall...

    # mkfs.fat -F 32 /dev/nvme0n1p1
    # mkfs.ext4 /dev/nvme0n1p3
    # mkfs.ext4 /dev/nvme1n1p1

    # mount /dev/nvme0n1p3 /mnt
    # mkdir /mnt/home
    # mount /dev/nvme1n1p1 /mnt/home
    # mkdir /mnt/boot
    # mount /dev/nvme0n1p1 /mnt/boot
    # mkswap /dev/nvme0n1p2
    # swapon /dev/nvme0n1p2

  Note: When I did the mkswap, I Got

    warning: wiping old swsuspend signature.

  I had just configured maxwell4 to suspend/hibernate
  and had confirmed I could trigger such.  Maybe things
  didn't work out when system tried on its own?  I had
  left the system unattended for a while.  I had it
  unplugged for a while, but I think it went south a
  while after plugging it back in.

  This time I won't set up suspend/hibernate features.

  Went to use reflector, but found that the reflector
  service was run and configured /etc/pacman.d/mirrorlist.
  The reflector service and timer are currently inactive.
  The service is enabled (runs on boot) but the timer
  is disabled.  (That is for the OS running on the ISO).

  Install essential packages to target system,

    # pacstrap /mnt base linux linux-firmware

  Note (From Arch wiki install guide):
    - linux can be substituted for another kernel package
    - linux omitted entirely if installed into a container
    - linux-firmware can be omitted if installed into either
      a container or virtual machine

  Configure /etc/fstab

    # genfstab -U /mnt >> /mnt/etc/fstab

  Chroot into the target system.

    # arch-chroot /mnt

  Configure time zone.

    # ln -sf /usr/share/zoneinfo/America/Denver /etc/localtime
    # hwclock --systohc

  No editor, install nvim.

    # pacman -Syu neovim

  Localization, uncommented en_US.UTF-8 UTF-8 in
  /etc/locale.gen

    # locale-gen

  Create /etc/locale.conf with contents

    LANG=en_US.UTF-8

  Give target system a hostname, create /etc/hostname
  with contents

    euler7

  Give root a password

    # passwd

  Need to install some networking related packages,

    # pacman -Syu iwd systemd-resolvconf modemmanager
    # ln -sf /run/systemd/resolve/stub-resolve.conf /etc/resolve.conf
    ln: '/run/systemd/resolve/stub-resolve.conf' and '/etc/resolv.conf' are the same file

  Opps, something has changed from last month.

    # ls -i /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf
    2617 /etc/resolve.conf  2617 /run/systemd/resolve/stub-resolv.conf

  Hard linked!

    # systemctl is-enabled systemd-resolved
    disabled
    # systemctl enable systemd-resolved

  I will use the systemd boot loader

    # bootctl install
    Created "/boot/EFI"
    Created "/boot/EFI/systemd"
    Created "/boot/EFI/BOOT"
    Created "/boot/loader"
    Created "/boot/loader/entries"
    Created "/boot/EFI/Linux"
    Copied "/usr/lib/systemd/boot/efi/systemd-bootx64.efi" \
              to "/boot/EFI/systemd/systemd-bootx64.efi".
    Copied "/usr/lib/systemd/boot/efi/systemd-bootx64.efi" \
              to "/boot/EFI/BOOT/BOOTX64.EFI".
    Created "/boot/987dc5a567e54739920b683cb519cf9f".
    Random seed file /boot/loader/random-seed successfully written (512 bytes).
    Created EFI boot entry "Linux Boot Manager".

  Lets see if what we currently have even boots.  It created
  a loader.conf and no entries/*.conf.  My guess it will give
  me a boot menu with no choices except for the firmware.

    # ^D
    # systemctl poweroff

  It did exactly what I predicted!  Instead of just parroting
  what I did for gauss17 and the limited example given
  in Systemd-boot ArchWiki, I will read through the
  loader.conf(5) man page first.

2021-12-05:

  Configure systemd boot loader via the examples
  from /usr/share/systemd/bootctl.  Note that as before
  with maxwell4, I had to go with the Unix device name.

  I think this is due to some sort of udev race condition.

  Modified /boot/loader/loader.conf

    default arch
    timeout 5
    console-mode auto
    editor false

  Created /boot/loader/entries/arch.conf

    title Arch Linux
    linux /vmlinuz-linux
    initrd /initrsmfs-linux.img
    options root=/dev/nvme0n1p3 rootfstype=ext4 add-efi-memmap

  Will need to install Intel firmware package later.

  Powerdown, reboot.  Does not matter if thumbdrive stays
  in since you would need to hit <F12> to be able to boot
  from it.

2021-12-05:

  Sucessfully booted euler7 and logged in as root.

  Need to connect to wifi so I can use pacman.  See
  if systemd-resolved is running.

    # systemctl status systemd-resolved

  Yes it is.  But a symlink or funky hard link not there

    # ls -li /etc/resolv.conf
    14417959 -rw-r--r-- 1 root root 65 Nov 11 02:14 /etc/resolv.conf

    # ls -li /run/systemd/resolve/stub-resolv.conf
    736 -rw-r--r-- 1 sysemd-resolve sysemd-resolve 920 Dec  5 16:13 /run/systemd/resolve/stub-resolv.conf

  Create link

    # ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf

  Check wireless.

    # ip addr
    ...
    2: wlan0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
        link/either ...

  Bring it up.

  ...

  A lot of network thrashing .... will update log on this
  later when I can do so from euler7 directly.

2021-12-05:

  I have DNS for IPv6 working but not for IPv4.  Pacman works.

  Turning on Systemd's NTP service.

    # timedatectl set-ntp true

  Install GIT, fish, man

    # pacman -Syu git
    # pacman -Syu fish
    # pacman -Syu man-pages man-db

  Create regular user

    # useradd -d /home/grs -c Geoffrey -G wheel -s /usr/bin/fish -m grs
    # passwd grs

  Let's give root's bash environment a little love.

  For root's .bashrc:

    set -o vi
    export EDITOR=nvim
    export PAGER='nvim -R'
    export MANPAGER='nvim +Man!'

  For root's .bash_profile:

    [[ -f ~/.bashrc ]] && source ~/.bashrc

  Set up user grs global git environment.

    $ git config --global user.name grscheller
    $ git config --global user.email geoffrey@scheller.com
    $ git config --global core.editor nvim
    $ git config --global core.pager "nvim -R"
    $ git config --global pull.rebase false
    $ git config --global color.pager no

  Last one "no" because I want neovim to do the coloring.

  Install OpenSSH.

    # pacman -Syu OpenSSH

  Updated /etc/ssh/sshd_config for no root logins,
  port 22 and passwd authentication for now.

  Successfully ssh to euler7.

    ~> mkdir .ssh
    ~> chmod 700 .ssh

  Generated ssh keys for euler7.  Removed maxwell4 keys from
  ~/.ssh/authorized_keys and add euler7 keys.  Sync'ed
  versions between euler7 and gauss17.

  Added euler7 ssh key to GitHub account.  Removed maxwell4 key.

2021-12-06:

  It is not Unix until it has a C compiler installed.

    # pacman -Syu base-devel
    # pacman -Syu clang

2021-12-06:

  I got networking and name resolution "working" but not optimally.

  Created /etc/iwd/main.conf with the following contents:

    # Created by Geoffrey Scheller
    # From multiple web postings
    #
    # See https://iwd.wiki.kernel.org/interface_lifecycle
    #     https://insanity.industries/post/simple-networking
    #
    # We want idw to take full control of the underlying phy device

    [General]
    # Enable builtin DHCP-client within iwd for wifi
    EnableNetworkConfiguration=true

    # Radomize mac-address when iwd starts or hardware detected
    #AddressRandomization=once

    [Network]
    #EnableIPv6=true
    #EnableIPv4=true

    # For pure systemd-resolved choose
    #NameResolvingService=systemd

    # For systemd-resolved+systemd-resolvconf or openresolv
    NameResolvingService=resolvconf

  From the command

    # systemctl --type=service --state=running

  the following network support services are running.

    iwd.service                Wireless service
    systend-networkd.service   Network Configuration
    systend-resolved.service   Network Name Resolution

  At this point, I was resolving IPv6 names reliably but IPv4
  names were only occasionally being resolved.  So I "kicked"
  the networkd service

    # systemctl restart systemd-networkd

  while following the system logs with "journelctl -f".

  From

    # journelctl -b -1

  this is what I saw in real time on my apartment wifi network.

 1  :57 systemd[1]: systemd-networkd.service: Deactivated successfully.
 2  :57 systemd[1]: Stopped Network Configuration.
 3  :57 systemd[1]: Starting Network Configuration...
 4  :57 systemd-networkd[1207]: /etc/systemd/networkd.conf:27: Unknown key name 'UseDomains' in section 'DHCPv4', ignoring.
 5  :57 systemd-networkd[1207]: /etc/systemd/networkd.conf:34: Unknown section 'IPv6AcceptRA'. Ignoring.
 6  :57 systemd-networkd[1207]: wlan0: Link UP
 7  :57 systemd-networkd[1207]: wlan0: Gained carrier
 8  :57 systemd-networkd[1207]: lo: Link UP
 9  :57 systemd-networkd[1207]: lo: Gained carrier
10  :57 systemd-networkd[1207]: Enumeration completed
11  :57 systemd[1]: Started Network Configuration.
12  :57 systemd-networkd[1207]: wlan0: Connected WiFi access point: singlewhip650 (9c:c9:eb:54:5f:77)
...
15  :28 systemd-resolved[347]: Switching to fallback DNS server 1.1.1.1#cloudflare-dns.com.

  Lines 4 & 5 are are a misguided attempt on my part to fix the IPv4
  problem.  I'll remove these from networkd.conf.  At the time
  I thought IPv4 was not resolving at all.

  Lines 6 to 12 show that systemd-networkd is driving the wlan0 file
  level interface.  My guess is that iwd controls the underlying phy
  kernel device.

  Line 15 shows all may not be well and we are falling over to the
  first fallback DNS server.

  On the last boot at work I did not have this problem

    $ journalctl -b | grep systemd-networkd | fields 5 6 7 8
    ...
    systemd-networkd[301]: lo: Link UP
    systemd-networkd[301]: lo: Gained carrier
    systemd-networkd[301]: Enumeration completed
    systemd-networkd[301]: wlan0: Link UP
    systemd-networkd[301]: wlan0: Connected WiFi
    systemd-networkd[301]: wlan0: Gained carrier

2021-12-06:

  I found a new toy.

    $ ls -l /usr/bin/resolv*
    lrwxrwxrwx 1 root root     10 Nov 29 06:42 /usr/bin/resolvconf -> resolvectl
    -rwxr-xr-x 1 root root 129088 Nov 29 06:42 /usr/bin/resolvectl

    $ pacman -Qo (digpath resolvectl)
    /usr/bin/resolvectl is owned by systemd 250.3-1

    $ resolvectl status
    Global
               Protocols: +LLMNR +mDNS -DNSOverTLS DNSSEC=no/unsupported
        resolv.conf mode: stub
    Fallback DNS Servers: 1.1.1.1#cloudflare-dns.com 9.9.9.10#dns.quad9.net 8.8.8.8#dns.google
                          2606:4700:4700::1111#cloudflare-dns.com 2620:fe::10#dns.quad9.net
                          2001:4860:4860::8888#dns.google

    Link 3 (wlan0)
        Current Scopes: DNS LLMNR/IPv4
             Protocols: +DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
    Current DNS Server: 1.1.1.1
           DNS Servers: 1.1.1.1 1.1.0.0


    $ resolvectl query github.com
    github.com: 140.82.112.3                       -- link: wlan0

    -- Information acquired via protocol DNS in 19.7ms.
    -- Data is authenticated: no; Data was acquired via local or encrypted transport: no
    -- Data from: network

    $ resolvectl query gitlab.com
    gitlab.com: 172.65.251.78                      -- link: wlan0
                2606:4700:90:0:f22e:fbec:5bed:a9b9 -- link: wlan0

    -- Information acquired via protocol DNS in 19.6ms.
    -- Data is authenticated: no; Data was acquired via local or encrypted transport: no
    -- Data from: network

    $ pacman -Qo /usr/bin/resolvectl
    /usr/bin/resolvectl is owned by systemd 249.7-2

2021-12-07:

  Used visudo to edit /etc/sudoers as root.

   - allow members of wheel to execute commands as root w/o pw
   - set secure_path="/usr/local/bin:/usr/bin"
   - did NOT reset $HOME to user's home directory
   - did NOT configure to use user's X GUI environment

  Basically I am not letting user GUI tools to run as root and
  making it harder for user to be fooled by a Trojan horse.

  Also, certain environment variables like $EDITOR now will
  not get picked up, so a few more things will actually
  have to be done as root.  Another work around

    $ sudo EDITOR=nvim systemctl edit --full sshd.service

2021-12-07:

  Edited /etc/ssh/sshd_configuration, moved sshd to a high port.

    $ sudo systemctl restart sshd.service

2021-12-07:

  Decided to install Sway as my desktop.

   - Wayland version of i3
   - Minimal
   - Geared to "power users"
   - More time to learn due to Christmas holidays coming up

  First continue setting up infrastructure.

2021-12-07:

  Install intel-ucode package.

    $ sudo pacman -Syu intel-ucode

  Updated /boot/loader/entries/arch.conf with third line.

    title Arch Linux
    linux /vmlinuz-linux
    initrd /intel-ucode.img
    initrd /initramfs-linux.img
    options root=/dev/nvme0n1p3 rootfstype=ext4 add-efi-memmap

  Reboot.

    $ journalctl -b -1|head -3
    -- Journal begins at Sun 2021-12-05 15:42:35 MST, ends at Tue 2021-12-07 16:44:05 MST. --
    Dec 07 12:30:44 euler7 kernel: Linux version 5.15.6-arch2-1 (linux@archlinux) (gcc (GCC) 11.1.0, GNU ld (GNU Binutils) 2.36.1) #1 SMP PREEMPT Thu, 02 Dec 2021 15:47:09 +0000
    Dec 07 12:30:44 euler7 kernel: Command line: initrd=\initramfs-linux.img root=/dev/nvme0n1p3 rootfstype=ext4 add-efi-memmap

    $ journalctl -b|head -4
    -- Journal begins at Sun 2021-12-05 15:42:35 MST, ends at Tue 2021-12-07 16:45:19 MST. --
    Dec 07 16:34:10 euler7 kernel: microcode: microcode updated early to revision 0xea, date = 2021-01-05
    Dec 07 16:34:10 euler7 kernel: Linux version 5.15.6-arch2-1 (linux@archlinux) (gcc (GCC) 11.1.0, GNU ld (GNU Binutils) 2.36.1) #1 SMP PREEMPT Thu, 02 Dec 2021 15:47:09 +0000
    Dec 07 16:34:10 euler7 kernel: Command line: initrd=\intel-ucode.img initrd=\initramfs-linux.img root=/dev/nvme0n1p3 rootfstype=ext4 add-efi-memmap

2021-12-07:

  Install pipewire and wireplumber, based on what I did on 2021-11-20 for maxwell4.

    sudo pacman -Syu wireplumber pipewire-pulse pipewire-jack wireplumber-doc \
                     pipewire-docs pipewire-alsa vorbis-tools alsa-utils \
                     alsa-plugins tree sof-firmware alsa-ucm-conf alsa-firmware

                     2021-12-10: should add jack2 to list?

  Reboot

    $ amixer sset Master unmute
    $ cd ~/Music/PopRock/The\ Beau\ Bremmels/
    $ ogg123 'Laugh Laugh.ogg'

  Sound works.

2021-12-07:

  Get Bluetooth working, following via ArchWiki.
  First check if kernel drivers are installed.

    $ lsmod|grep btusb
    btusb                  65536  0
    btrtl                  28672  1 btusb
    btbcm                  24576  1 btusb
    btintel                45056  1 btusb
    bluetooth             749568  5 btrtl,btintel,btbcm,btusb

  Install service and get user software.

    $ sudo pacman -Syu bluez bluez-utils

  Enable and start service

    $ sudo systemctl enable bluetooth.service
    $ sudo systemctl start bluetooth.service


  For help,

    $ bluetoothctl help
    $ man -s8 bluetoothd

2021-12-08:

  Today I will install Sway.  By default, Sway does not use a display manager.

  Got an idea of what I want to do from the Sway ArchWiki page and
  this Youtube video: https://www.youtube.com/watch?v=hRIGYUWQfYU

  I will be following this guide: https://www.fosskers.ca/en/blog/wayland
  more or less.

    $ sudo pacman -Syu \
          sway alacritty waybar wofi \
          xorg-xwayland xorg-xlsclients qt5-wayland glfw-wayland
    :: Synchronizing package databases...
     core is up to date
     extra is up to date
     community is up to date
    :: Starting full system upgrade...
    resolving dependencies...
    :: There are 8 providers available for ttf-font:
    :: Repository extra
       1) gnu-free-fonts  2) noto-fonts  3) ttf-bitstream-vera  4) ttf-croscore  5) ttf-dejavu
    :: Repository community
       6) ttf-droid  7) ttf-ibm-plex  8) ttf-liberation

    Enter a number (default=1): ^C
    Interrupt signal received

2021-12-08:

  Aside: Fonts

  I am not a great font connoisseur.  I want

   - good Unicode coverage
   - minimal bloat, simple to configure
   - not glaringly ugly
   - to learn better how to handle fonts in code

  The ArchWiki font configuration page has good info I will draw upon.

  The freedesktop.org's Fontconfig library is what most modern GUI
  and printer applications use to quickly find needed fonts.  The local
  per user configuration file is

    ~/.config/fontconfig/fonts.conf

  and globally set via

    /etc/fonts/local.conf

  Older X applications use two different font systems

   - the older X Logical Font Description (XLFD)
     - originally designed for bitmap fonts
     - scalable fonts added later
     - does not support anti-aliasing & sub-pixel rasterization
   - the newer X FreeType (Xft)
     - uses FreeType & Fontconfig libraries
     - more suitable when smooth font appearance desired

  Example of an application using XLFD names:

    $ xterm -fn -misc-fixed-medium-r-semicondensed--13-120-75-75-c-60-iso8859-1 &
    $ xterm -fn "-*-fixed-medium-r-s*--13-120-*-*-*-*-iso8859-1" &

  The above is what I used to refer to as "magical Unix incantations."

  Any case, I need to choose some fonts.  The default choice is
  GNU Unifont but I hear good things about Noto fonts.  Both
  have good Unicode coverage and open licenses.  Both allow for
  embedding in commercial software.  The GNU may be bitmap fonts,
  they were developed along side XFree86 and XOrg.  Noto was
  commissioned by Google in the 2010's and are more modern.

  Lets go with the Noto fonts, Pacman package noto-fonts.

2021-12-08:

  Back to installing Sway.

    $ sudo pacman -Syu \
          sway alacritty waybar wofi \
          xorg-xwayland xorg-xlsclients qt5-wayland glfw-wayland \
          noto-fonts
    :: Synchronizing package databases...
     core                    137.4 KiB   528 KiB/s 00:00 [############################] 100%
     extra                  1565.4 KiB  9.38 MiB/s 00:00 [############################] 100%
     community                 5.8 MiB  26.9 MiB/s 00:00 [############################] 100%
    :: Starting full system upgrade...
    resolving dependencies...
    :: There are 2 providers available for opengl-driver:
    :: Repository extra
       1) mesa  2) nvidia-utils

    Enter a number (default=1): 1
    looking for conflicting packages...
    ...

  I chose the mesa package.  Did not what to risk dragging in the proprietary
  NVIDIA drivers.  Pretty sure the older hybrid, non-GBM NVIDIA GeForce MX250
  Graphics card will never be able to support Wayland.

  Let's reboot and see if we can get a Sway session going.

2021-12-08:

  Lets configure Sway with the default configuration.

    $ cd ~/.config
    $ mkdir sway
    $ cp /etc/sway/config sway/

  Some useful commands to know before launching the first time.

   - Reload Sway:    Super+Shift+c
   - Exit Sway:      Super+Shift+e
   - Open Terminal:  Super+Return
   - Open Program:   Super+d

  Launch Sway.

    $ sway

  Got a desktop, first two keybindingd worked.  Second two did not.

  I know why alarcritty fails, it is my MacOS hack for it in alacritty.yml.

    # ls -s /usr/bin/fish /usr/local/bin/fish
    $ sway

  Alacritty works!  Also, sway is mouse focused!

  Super+d does not work, but I am going to swap out the program
  launcher anyway.

  Super+e swaps the placement of two alacritty windows from
  left by right to top over bottom respectively, and back.

2021-12-10:

  Installing firefox so that I can continue primping euler7 without
  having to run over to another computer to research stuff.

    $ sudo pacman -Syu firefox

  Note that this brings in the jack2 package.  At least Pacman
  thinks this is compatible with pirewire-jack and wireplumber.

2021-12-12:

  Continue configuring Sway via https://www.fosskers.ca/en/blog/wayland

  Things I want this guide to help me accomplish:

   - Configure Waybar, a topbar very similar to Polybar.
   - Configure Wofi, a pure GTK (and thus Wayland) customizable application launcher.
   - Firefox and/or Chromium in Wayland with working screen sharing.
   - Most QT applications running in Wayland.  GTK should just work.
   - Steam games set up to consider Wayland, if they can (maybe).

2021-12-13:

  Configure Waybar for sway.  Edit ~/.config/sway/config,
  comment the bar section and add

    bar {
        swaybar_command waybar
    }

  Replace program launcher dmenu with wofi.  Factoid: denu uses
  XWayland while wofi is a GTK application, hence Wayland compatible.

    #set $menu dmenu_path | dmenu | xargs swaymsg exec --
    set $menu wofi --show=drun --lines=5 --prompt=""

  The drun option above only matches and displays hits for programs
  that have "Desktop" entries.

  Note that out of the box firefox runs under XWayland.

    $ xlsclients
    euler7  firefox

  In ~/.config/fish/config.fish

    set -x MOZ_ENABLE_WAYLAND 1

  Logout both sway & console.

    $ xlsclients

  Firefox now running completely under Wayland.

2021-12-14:

  Needed for firefox to screen share.

   $ sudo pacman -Syu xdg-desktop-portal-wlr

  This also brought in xfg-desktop-portal and a bunch
  of fuse (user space file system) stuff and something
  called geoclue.

    $ pacman -Ss geoclue
    extra/geoclue 2.5.7-4 [installed]
        Modular geoinformation service built on the D-Bus messaging system
    community/pantheon-geoclue2-agent 1.0.5-1 (pantheon)
        Pantheon Geoclue2 Agent

  Hummm...What are doing Firefox?

  Test out changes here:

    https://mozilla.github.io/webrtc-landing/gum_test.html

  Screen sharing seemed to work.  Have to share entire screen.
  Sharing idividual windows is in the works, but does not work yet.

2021-12-15:

  Install legacy GNOME polkit deamon for Sway.  Has no external
  dependencies.

    $ sudo pacman -Syu polkit-gnome

 Added the following  line to ~/.config/sway/config

   exec_always /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

2021-12-16:

  Fixed waybar not having its icons.

    $ sudo pacman -S otf-font-awesome

2021-12-17:

  Neovim's "+ and "* registers don't work.
  The first is the "system" clipboard, the second the "X11" clipboard.

  Let's install the Wayland clibboard tool

    $ pacman -Ss wl-clipboard
    community/wl-clipboard 1:2.0.0-2
        Command-line copy/paste utilities for Wayland
    $ sudo pacman -S wl-clipboard

  Without any configuration, both registers seem to work and
  are distinct.  The xlsclient is not showing any XWayland
  stuff when "* is used.

  In nvim, :h clipboard-tool shows that order of searching for clipboard
  tools are,

    - |g:clipboard|
    - pbcopy, pbpaste (macOS)
    - wl-copy, wl-paste (if $WAYLAND_DISPLAY is set)
    - xclip (if $DISPLAY is set)
    - xsel (if $DISPLAY is set)
    - lemonade (for SSH) https://github.com/pocke/lemonade
    - doitclient (for SSH) http://www.chiark.greenend.org.uk/~sgtatham/doit/
    - win32yank (Windows)
    - termux (via termux-clipboard-set, termux-clipboard-set)
    - tmux (if $TMUX is set)

  Seems that regardless whether or not XWayland is running, I still
  have two distinct clipboards in Wayland.  X11 style middle-mouse
  highlighted paste is associated with the "* register and (with my
  alcritty keybindings) alt+c & alt+v the "system" clipboard is
  associated with the "+ register.  As before, I can also paste
  through alacritty directly into neovim insert mode via alt-v.

  After further research, freedesktop.org describes the two main
  selections as follows:

  PRIMARY
    Used for the currently selected text, even if it is not explicitly
    copied, and for middle-mouse-click pasting. In some cases, pasting
    is also possible with a keyboard shortcut.

  CLIPBOARD
    Used for explicit copy/paste commands involving keyboard
    shortcuts or menu items. Hence, it behaves like the single
    clipboard system on Windows. Unlike PRIMARY, it can also
    handle multiple data formats.

  Qt and GTK applications follow this behavior, as do most
  Xorg applications.

  Therefore, I have not been interacting with two clipboard systems
  but with one with backward compatible behaviors.

  Arch does not seem to have a Sway oriented drop in replacement
  for gpaste or clipman.  I don't want to unnecessarily drag in
  too much of GNOME or XFCE, so I will forego a clipboard history
  manager for now.

2021-12-18:

  Following this "Root Labs" video to configure Waybar for Sway

    https://www.youtube.com/watch?v=oUpvtCEGrxQ

  Installing Waybar default font Roboto.  Also Roboto Mono Medium.

    $ sudo pacman -S ttf-roboto ttf-roboto-mono

  Edited ~/.config/waybar/style.ccs lines near top from

    boarder-radius: 0;
    font-family: Roboto, Helvetica, Arial, sans-serif;
    font-size: 13px;

  to

    boarder-radius: 4px;
    font-family: "Roboto Mono Medium", Roboto, Arial, sans-serif;
    font-size: 18px;

  Also edited ~/.config/waybar/config

2021-12-22:

  Installed and enabled reflector service.

    $ sudo pacman -Syu reflector
    $ systemctl enable reflector.timer

  Installed and enabled locate service.

    $ sudo pacman -Syu mlocate

  Could not figure out how to enable the updatedb.timer
  for the locate command.  Went back later and

    $ systemctl list-timers

  showed not only it was configured, but successfully ran.

2021-12-24:

  Install and configure screen locker and idle manager
  for Sway.

    $ sudo pacman -Syu swaylock swayidle

  See dotfiles repo for ~/.config/sway/config configuration.

2021-12-27:

  Installed ruby and rubygems for neovim and mdl plugins.

    $ sudo pacman -Syu ruby rubygems
    $ gem install neovim
    $ gem install mdl

2021-12-27:

  Moved into place /etc/nsswitch.conf.pacnew

  Temporarily replces resolve.services /etc/resolv.conf symlink
  with a file pointing to nameserver 1.1.1.1.  Comcast's nameserver
  is not resolving github.com for euler7.  Is working for gauss17.

2021-12-30:

  Install node.js amd npm infrastructure for nvim.

    $ sudo pacman -Syu nodejs npm npm-check-updates
    $ sudo npm install -g neovim

2022-01-16:

  Intend to maintain a local file based repo to manage
  AUR and locally built software.  Same as I do for
  gauss17.  Instead of redoing creating such, I will
  automate syncing gauss17's version with euler7's version
  via rsync.

  First some Pacman cleanup:

  1. First update system

       $ sudo pacman -Syu

  2. Get rid of orphans

       $ pacman -Qdt
       celt 0.11.3-4
       zita-alsa-pcmi 0.4.0-1
       zita-resampler 1.8.0-1

       $ sudo pacman -R (pacman -Qdtq)

  3. See what "foreign" packages, not associated with any sync'ed database,
     are installed.

       $ pacman -Qm

     No such installed.

  4. Add a local repo that can be kept in sync via rsync with one on gauss17.

     First add rsync to euler7

       $ sudo pacman -Syu rsync

     Add the following lines to the end of /etc/pacman.conf

       [archlocal]
       SigLevel = Optional TrustAll
       Server = file:///home/grs/build/ArchLocalRepo

     then

       $ mkdir -p ~/build/ArchLocalRepo
       $ rsync -rav gauss17:build/ArchLocalRepo ~/build/

     now install coursier to euler7

       $ sudo pacman -Syu coursier

2022-01-17:

  Using website https://arewewaylandyet.com, to help make choices
  of software to install.  See also gauss17ArchLinuxAdmin.log for
  the same date.

  Need a file manager, nemo from Cinnamon Desktop (Linux Mint) is
  the only one on the list.  I liked Cinnamon.

    $ sudo pacman -Syu nemo
    $ gsettings set org.cinnamon.desktop.default-applications.terminal exec alacritty

  Decided not to install an email client on my work computer.  Will
  use web interfaces for email instead.

  For video players, clapper and mpv are on list.  Only the later
  is in the standard Arch repos.

    $ sudo pacman -Syu mpv

2022-01-22:

  While doing a

    $ sudo pacman -Syu
    ...
    looking for conflicting packages...
    :: pipewire-jack and jack2 are in conflict (jack). Remove jack2? [y/N] y
    ...

2022-01-22:

  I wish to get to the bottom of why getent is working
  differently on euler7 than gauss17 in my apartment.
  It is not resolving IP4 addresses and I end up having
  to swap out the /etc/resolv.conf link on euler7.
  Everything works correctly at work, house, and airports.

    {euler7]$ pacman -Qs resolv
    local/python-resolvelib 0.5.5-4
        Resolve abstract dependencies into concrete ones
    local/systemd-resolvconf 250.2-2
        systemd resolvconf replacement (for use with systemd-resolved)

    [gauss17]$ pacman -Qs resolv
    local/openresolv 3.12.0-1
        resolv.conf management framework (resolvconf)
    local/python-resolvelib 0.5.5-4
        Resolve abstract dependencies into concrete ones

  Opps, thought I was using systemd-resolvconf on both.  Also,

    [euler7]$ pacman -Qs dhcpcd

    [gauss17]$ pacman -Qs dhcpcd
    local/dhcpcd 9.4.1-1
        RFC2131 compliant DHCP client daemon

    [gauss17]$ systemctl is-enabled dhcpcd
    disabled

  Seems that I disabled it on gauss17 way back on 2017-06-27.  I will install
  dhclient like is installed on gauss17.

    $ sudo pacman -Syu dhclient

  Reboot.   After reboot, network came up without me having to use my
  "kw" abbr.  Actually just ssh right into euler7 after reboot.

  Now,

    $ getent hosts gitlab.com
    2606:4700:90:0:f22e:fbec:5bed:a9b9 gitlab.com

  and

    $ getent hosts github.com
    140.82.113.4    github.com

  but the second one took a long time.  At least an improvement.

    [euler7]$ ip route
    default via 192.168.1.1 dev wlan0 proto dhcp metric 303
    192.168.1.0/24 dev wlan0 proto dhcp scope link src 192.168.1.6

    [euler7]$ ip -6 route
    ::1 dev lo proto kernel metric 256 pref medium

    [gauss17]$ ip route
    default via 192.168.1.1 dev wlan0 proto dhcp metric 304
    192.168.1.0/24 dev wlan0 proto dhcp scope link src 192.168.1.5

    [gauss17]$ ip -6 route
    ::1 dev lo proto kernel metric 256 pref medium

  Found a version of getent which returns right away,

    [euler7]$ getent ahosts github.com
    140.82.113.3    STREAM github.com
    140.82.113.3    DGRAM
    140.82.113.3    RAW

    [euler7]$ getent ahosts gitlab.com
    172.65.251.78   STREAM gitlab.com
    172.65.251.78   DGRAM
    172.65.251.78   RAW

  Read getent manpage, not sure the difference.

  From researching this problem, I found information on how
  to make glibc prefer IPv6 over IPv4 addresses.  In /etc/gai.conf
  uncomment the lines

    #label ::1/128       0
    #label ::/0          1
    #label 2002::/16     2
    #label ::/96         3
    #label ::ffff:0:0/96 4
    #label fec0::/10     5
    #label fc00::/7      6
    #label 2001:0::/32   7

  which I did.

  Reboot.

  Except for getent being a bit tardy, no network issues at
  my apartment.

    $ systemctl is-enabled systemd-resolved
    enabled

2022-01-22:

  With core/systemd-resolvconf insalled on both euler7 & gauss17,
  both show tardy getent behavior for IPv4 hosts.  Let's try
  core/openresolv on both systems.

    $ sudo pacman -Syu openresolv
    ...
    : openresolv and systemd-resolvconf are in conflict. Remove systemd-resolvconf? [y/N] y
    ...

  Reboot.

    $ ls -l /etc/resolv.conf
    lrwxrwxrwx 1 root root 37 Dec 30 09:31 /etc/resolv.conf -> /run/systemd/resolve/stub-resolv.conf

  Opps, /etc/resolv.conf pointing to a target which is no longer there.

  The openresolv package is for keeping writers to /etc/resolv.conf from
  not clobber each other's changes.  After reading the openresolv configuration
  documentation, I think systemd-resolvconf is the better way forward.

    $ sudo pacman -Syu systemd-resolvconf

  Reboot.

2022-01-27:
  Install Libre Office.

    $ sudo pacman -Syu libreoffice-fresh

2022-01-27:

  Notice some far east fonts not rendering well.

    $ pacman -Ss noto-fonts
    extra/noto-fonts 20201226-2 [installed]
        Google Noto TTF fonts
    extra/noto-fonts-cjk 20220126-1
        Google Noto CJK fonts
    extra/noto-fonts-emoji 20211101-1
        Google Noto emoji fonts
    extra/noto-fonts-extra 20201226-2
        Google Noto TTF fonts - additional variants

  Let's go for all the Noto fonts.

    $ sudo pacman -Syu noto-fonts-cjk noto-fonts-emoji noto-fonts-extra

2022-01-28:

  Configuring euler7 to use multiple versions of Python
  via community/pyenv package.

    $ sudo pacman -Syu pyenv

  see adminLogs/ArchPythonAdmin.log for details.

2022-03-29:

  Got an ethernet port via USB-C "minidoc".  I think iwd uses
  dhclient.  I'll install dhcpcd too so I have both.

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
        inet 10.100.45.248/24 scope global noprefixroute wlan0
           valid_lft forever preferred_lft forever
    4: enp59s0u1u4: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff$ ip addr

  Linux sees the hardware.

    $ systemctl list-unit-files --type service -all
    UNIT FILE                                  STATE           VENDOR PRESET
    ...
    dhclient@.service                          disabled        disabled
    dhcpcd.service                             disabled        disabled
    dhcpcd@.service                            disabled        disabled
    ...
    iwd.service                                enabled         disabled
    ...
    ModemManager.service                       disabled        disabled
    ...
    systemd-network-generator.service          disabled        enabled
    systemd-networkd-wait-online.service       enabled         disabled
    systemd-networkd.service                   enabled         enabled
    ...
    systemd-resolved.service                   enabled         enabled
    ...

  Now I remember, iwd has its own internal dhcp client.  Network Manager
  used dhclient.  Since I am not using Redhat's Network Manager, I'll
  configure the more feature rich dhcpcd.

  Let's turn it on and iwd off.

    $ sudo systemctl enable dhcpcd
    Created symlink /etc/systemd/system/multi-user.target.wants/dhcpcd.service → /usr/lib/systemd/system/dhcpcd.service.

    $ sudo systemctl disable iwd
    Removed /etc/systemd/system/multi-user.target.wants/iwd.service.

    $ sudo systemctl stop iwd

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    4: enp59s0u1u4: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff

    $ sudo systemctl start dhcpcd

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    4: enp59s0u1u4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
        inet 10.100.51.180/22 brd 10.100.51.255 scope global dynamic noprefixroute enp59s0u1u4
           valid_lft 86370sec preferred_lft 75570sec
        inet6 fe80::8a9a:24c6:15db:912/64 scope link
           valid_lft forever preferred_lft forever

2022-03-29:
  Bringing euler7 & gauss17 more in alignment.

  Compairing them side-by-side with "systemctl status" and
  "systemctl status <unit>" and looking for error messages
  and differences.

  Sshd problems:

    - pam_systemd_home(sshd:account): systemd-homed is not available:
      Unit dbus-org.freedesktop.home1.service not found.
    - pam_env(sshd:session): deprecated reading of user environment enabled

  Enable service:

    $ sudo systemctl enable systemd-homed

  After reboot, now have the issue:

    Started OpenSSH Daemon.
    Server listening on 0.0.0.0 port 22555.
    Server listening on :: port 22555.
    pam_systemd_home(sshd:account): Not a user managed by systemd-homed: No home for user grs known
    Accepted publickey for grs from 192.168.1.2 port 59330 ssh2: RSA SHA256: ...
    pam_unix(sshd:session): session opened for user grs(uid=1000) by (uid=0)
    pam_env(sshd:session): deprecated reading of user environment enabled

2022-04-07:
  Will work on systemd-homed with gauss17.

2022-04-07:
  Configuing CUPS printing on euler7.  Start off by following ArchWiki.

  Install Cups:

    $ sudo pacman -S cups cups-pdf

  Optional dependencies for imagemagick
    ghostscript: PS/PDF support [installed]
    libheif: HEIF support [installed]
    libjxl: JPEG XL support
    libraw: DNG support [installed]
    librsvg: SVG support [installed]
    libwebp: WEBP support [installed]
    libwmf: WMF support
    libxml2: Magick Scripting Language [installed]
    libzip: OpenRaster support
    ocl-icd: OpenCL support
    openexr: OpenEXR support
    openjpeg2: JPEG2000 support [installed]
    djvulibre: DJVU support [installed]
    pango: Text rendering [installed]
    imagemagick-doc: manual and API docs

  Optional dependencies for cups-filters
    ghostscript: for non-PostScript printers to print with CUPS to convert PostScript
    to raster images [installed]
    foomatic-db: drivers use Ghostscript to convert PostScript to a printable form
    directly
    foomatic-db-engine: drivers use Ghostscript to convert PostScript to a printable
    form directly
    foomatic-db-nonfree: drivers use Ghostscript to convert PostScript to a printable
    form directly
    antiword: to convert MS Word documents
    docx2txt: to convert Microsoft OOXML text from DOCX files

  Optional dependencies for cups
    ipp-usb: allows to send HTTP requests via a USB connection on devices without
    Ethernet or WiFi connections
    xdg-utils: xdg .desktop file support [installed]
    colord: for ICC color profile support
    logrotate: for logfile rotation support [installed]

  The above Pacman install also gave some helpful factoids:

    To use cups-pdf, restart cups and visit the cups
    web interface at http://localhost:631/

    You can now add a "Virtual Printer (PDF Printer)"
    and use the Postscript/Generic postscript color
    printer driver.

    Note that cups-pdf has a configuration
    file in /etc/cups. The default location for
    pdf output is /var/spool/cups-pdf/$username.

  Let's go after some of the above missing dependencies.

    $ sudo pacman -S libjxl libjxl-doc libwmf libzip \
                     ocl-icd openexr imagemagick-doc

    $ sudo pacman -S foomatic-db foomatic-db-engine \
                     foomatic-db-nonfree antiword docx2txt\
                     foomatic-db-nonfree-ppds

    $ sudo pacman -S ipp-usb colord

    $ sudo pacman -S gutenprint foomatic-db-gutenprint-ppds

  Let's see whats up.

    $ systemctl status cups.service
    ○ cups.service - CUPS Scheduler
       Loaded: loaded (/usr/lib/systemd/system/cups.service; disabled; vendor preset: d>
       Active: inactive (dead)
    TriggeredBy: ○ cups.socket
         Docs: man:cupsd(8)

    $ systemctl status cups.socket
    ○ cups.socket - CUPS Scheduler
       Loaded: loaded (/usr/lib/systemd/system/cups.socket; disabled; vendor preset: di>
       Active: inactive (dead)
     Triggers: ● cups.service
       Listen: /run/cups/cups.sock (Stream)

  I don't print much, I think the socket listener will be enough.

    $ sudo systemctl enable cups.socket
    Created symlink /etc/systemd/system/sockets.target.wants/cups.socket → /usr/lib/systemd/system/cups.socket.

  How CUPS works (from ArchWiki):

    1. An application sends a PDF file to CUPS when 'print' has been
       selected.  In case the application sends another format, it is
       converted to PDF first.
    2. CUPS then looks at the printer's PPD file, printer description
       file, and figures out what filters it needs to use to convert
       the PDF file to a language that the printer understands, like
       PJL, PCL, bitmap or native PDF.
    3. The filter converts the PDF file to a format understood by the
       printer.
    4. Then it is sent to the back-end. For example, if the printer is
       connected to a USB port, it uses the USB back-end.

  Let's clean up and reboot.

    $ sudo pacman -Syu
    $ systemctl reboot

  Now, how to find a network printer...

  The Network section of the CUPS ArchWiki says Avahi is a
  zeo-config multicast DNS/DNS-SD service discovery system.

  1. It is installed on euler7, but not enabled.
  2. Seems both libcups and pipewire-pulse can use it, see
     pactree -r avahi
  3. Incompatible with systemd-resolved's multicast DNS
     resolver/responder.  See resolved.conf(5) or disable
     systemd-resolved.service entirely.
  4. I may want to read through the ArchWiki systemd-resolved
     and Avahi pages.

2022-04-08:
  Continue printer configuration.  Comparing with gauss17, I
  missed this one:

    $ sudo pacman -S foomatic-db-ppds

2022-04-10:
  I am in the process of going "all-in" with systemd-resolved for
  gauss17.  Once I get it better under control there, I'll address
  it here on euler7.

  Since euler7 spends most of its time on a Apple dominated
  network, may want to enable Avahi.  May need to either get
  resolved and avahi peasefully coexisting, or script things
  to be able swap between the two.

2022-04-19:
  Repeating what I did for gauss17 for

    /etc/iwd/main.conf
    /etc/systemd/resolved.conf.d/dns_servers.conf

  Had these in the root/ directory of my dotfiles repo.

    $ pacman -Ss systemd-resolvconf
    core/systemd-resolvconf 250.4-2 [installed]
        systemd resolvconf replacement (for use with systemd-resolved)

  Since I don't use moziiavpn on euler7, maybe I can remove
  systemd-resolved package?

    $ sudo pacman -R systemd-resolvconf
    checking dependencies...
    :: dhcpcd optionally requires openresolv: resolvconf support

    Packages (1) systemd-resolvconf-250.4-2


    :: Do you want to remove these packages? [Y/n] Y
    :: Processing package changes...
    (1/1) removing systemd-resolvconf                  [############] 100%
    :: Running post-transaction hooks...
    (1/1) Arming ConditionNeedsUpdate...

    $ sudo pacman -Syu

  Reboot.

    $ journalctl -f -b
    ...
    Apr 19 12:48:03 euler7 systemd-networkd-wait-online[335]: Timeout occurred while waiting for network connectivity.
    Apr 19 12:48:03 euler7 systemd[1]: systemd-networkd-wait-online.service: Main process exited, code=exited, status=1/FAILURE
    Apr 19 12:48:03 euler7 systemd[1]: systemd-networkd-wait-online.service: Failed with result 'exit-code'.
    Apr 19 12:48:03 euler7 systemd[1]: Failed to start Wait for Network to be Configured.
    Apr 19 12:48:03 euler7 audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=systemd-networkd-wait-online comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=failed'
    Apr 19 12:48:03 euler7 systemd[1]: Reached target Network is Online.
    ...

  This problem still needs to be addressed.  When I go home this evening, let's see
  if we have same problem on gauss17.

    $ systemctl status | head -5
    ● euler7
        State: degraded
         Jobs: 0 queued
       Failed: 1 units
        Since: Tue 2022-04-19 12:46:03 MDT; 11min ago

  Status is "starting" before the failure of the
  systemd-networkd-wait-online.service.

  Let's try rebooting ititially without Ethernet, then
  "kick" wifi and plugin Ethernet cable into USB-C dongle.

  Reboot.

    $ journalctl -f -b
    Apr 19 13:04:34 euler7 dhcpcd[382]: enp59s0u1u4: leased 10.100.51.180 for 78418 seconds
    Apr 19 13:04:34 euler7 dhcpcd[382]: enp59s0u1u4: adding route to 10.100.48.0/22
    Apr 19 13:04:34 euler7 dhcpcd[382]: enp59s0u1u4: adding default route via 10.100.50.1
    Apr 19 13:04:42 euler7 dhcpcd[382]: enp59s0u1u4: no IPv6 Routers available
    Apr 19 13:05:43 euler7 systemd-networkd-wait-online[321]: Timeout occurred while waiting for network connectivity.
    Apr 19 13:05:43 euler7 systemd[1]: systemd-networkd-wait-online.service: Main process exited, code=exited, status=1/FAILURE
    Apr 19 13:05:43 euler7 systemd[1]: systemd-networkd-wait-online.service: Failed with result 'exit-code'.
    Apr 19 13:05:43 euler7 systemd[1]: Failed to start Wait for Network to be Configured.
    Apr 19 13:05:43 euler7 audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=systemd-networkd-wait-online comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=failed'
    Apr 19 13:05:43 euler7 systemd[1]: Reached target Network is Online.

  Both external interfaces are up

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    3: enp59s0u1u4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
        inet 10.100.51.180/22 brd 10.100.51.255 scope global dynamic noprefixroute enp59s0u1u4
           valid_lft 78125sec preferred_lft 68322sec
        inet6 fe80::8a9a:24c6:15db:912/64 scope link
           valid_lft forever preferred_lft forever
    4: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
        inet 10.100.45.165/24 scope global noprefixroute wlan0
           valid_lft forever preferred_lft forever
        inet 10.100.45.248/24 brd 10.100.45.255 scope global secondary dynamic noprefixroute wlan0
           valid_lft 86095sec preferred_lft 75295sec
        inet6 fe80::d531:e950:9b3e:29ea/64 scope link
           valid_lft forever preferred_lft forever

  Why two IPv4 addresses on the wireless network?  Same thing happened at
  work yesterday with gauss17.

  Multiple dhcp clients running?  I know iwd has one, maybe systemd-networkd?
  Do I need dhcpcd?  Do I need iwd dhcp client turned on?

  Disabled dhcpcd, rebooted, and kicked wifi via "iwctl device list".

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    3: enp59s0u1u4: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
    4: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
        inet 10.100.45.123/24 scope global noprefixroute wlan0
           valid_lft forever preferred_lft forever
        inet6 fe80::a71:90ff:fec3:bb8a/64 scope link
           valid_lft forever preferred_lft forever

  Next step, enable dhcpcd, and turnoff dhcp client in iwd.
  In /etc/iwd/main.conf changed from true to false

    [General]
    # Enable builtin DHCP-client within iwd for wifi
    EnableNetworkConfiguration=false

  Reboot.

  Getting closer.

    $ journalctl -f -b
    Apr 19 14:15:25 euler7 systemd-networkd-wait-online[332]: Timeout occurred while waiting for network connectivity.
    Apr 19 14:15:25 euler7 systemd[1]: systemd-networkd-wait-online.service: Main process exited, code=exited, status=1/FAILURE
    Apr 19 14:15:25 euler7 systemd[1]: systemd-networkd-wait-online.service: Failed with result 'exit-code'.
    Apr 19 14:15:25 euler7 systemd[1]: Failed to start Wait for Network to be Configured.
    Apr 19 14:15:25 euler7 audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=systemd-networkd-wait-online comm="systemd" exe="/usr/lib/systemd/systemd" hostname=? addr=? terminal=? res=failed'
    Apr 19 14:15:25 euler7 systemd[1]: Reached target Network is Online.

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    2: wlan0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
    3: enp59s0u1u4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
        inet 10.100.51.180/22 brd 10.100.51.255 scope global dynamic noprefixroute enp59s0u1u4
           valid_lft 73983sec preferred_lft 64698sec
        inet6 fe80::8a9a:24c6:15db:912/64 scope link
           valid_lft forever preferred_lft forever

  Encouraging.  Looks like the wifi is not being restarted.  Also not configured either.

    $ networkctl
    IDX LINK        TYPE     OPERATIONAL SETUP
      1 lo          loopback carrier     unmanaged
      2 wlan0       wlan     no-carrier  unmanaged
      3 enp59s0u1u4 ether    routable    unmanaged

    3 l/
    inks listed.

  Looking at last 3 boots:

    $ journalctl -b -2|grep -E wlan0
    Apr 19 13:03:43 euler7 systemd-networkd[291]: wlan0: Link UP
    Apr 19 13:03:43 euler7 dhcpcd[382]: wlan0: waiting for carrier
    Apr 19 13:03:43 euler7 dhcpcd[382]: wlan0: carrier acquired
    Apr 19 13:03:43 euler7 dhcpcd[382]: wlan0: IAID 90:c3:bb:8a
    Apr 19 13:03:43 euler7 dhcpcd[382]: wlan0: adding address fe80::6cbb:d10:d97b:b3c
    Apr 19 13:03:43 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:03:43 euler7 dhcpcd[382]: wlan0: deleting address fe80::6cbb:d10:d97b:b3c
    Apr 19 13:04:14 euler7 systemd-networkd[291]: wlan0: Link DOWN
    Apr 19 13:04:14 euler7 dhcpcd[382]: wlan0: removing interface
    Apr 19 13:04:14 euler7 systemd-networkd[291]: wlan0: Link UP
    Apr 19 13:04:14 euler7 dhcpcd[382]: wlan0: waiting for carrier
    Apr 19 13:04:16 euler7 kernel: wlan0: authenticate with 6a:3a:0e:54:4c:4e
    Apr 19 13:04:16 euler7 kernel: wlan0: send auth to 6a:3a:0e:54:4c:4e (try 1/3)
    Apr 19 13:04:16 euler7 kernel: wlan0: authenticated
    Apr 19 13:04:16 euler7 kernel: wlan0: associate with 6a:3a:0e:54:4c:4e (try 1/3)
    Apr 19 13:04:16 euler7 kernel: wlan0: RX AssocResp from 6a:3a:0e:54:4c:4e (capab=0x1511 status=0 aid=4)
    Apr 19 13:04:16 euler7 kernel: wlan0: associated
    Apr 19 13:04:16 euler7 systemd-networkd[291]: wlan0: Connected WiFi access point: CC-Platform One (6a:3a:0e:54:4c:4e)
    Apr 19 13:04:16 euler7 kernel: wlan0: Limiting TX power to 27 (30 - 3) dBm as advertised by 6a:3a:0e:54:4c:4e
    Apr 19 13:04:16 euler7 dhcpcd[382]: wlan0: carrier acquired
    Apr 19 13:04:16 euler7 dhcpcd[382]: wlan0: connected to Access Point: CC-Platform One
    Apr 19 13:04:16 euler7 systemd-networkd[291]: wlan0: Gained carrier
    Apr 19 13:04:16 euler7 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
    Apr 19 13:04:16 euler7 dhcpcd[382]: wlan0: IAID 90:c3:bb:8a
    Apr 19 13:04:16 euler7 dhcpcd[382]: wlan0: adding address fe80::d531:e950:9b3e:29ea
    Apr 19 13:04:16 euler7 dhcpcd[382]: wlan0: soliciting an IPv6 router
    Apr 19 13:04:17 euler7 dhcpcd[382]: wlan0: rebinding lease of 10.100.45.248
    Apr 19 13:04:17 euler7 dhcpcd[382]: wlan0: probing address 10.100.45.248/24
    Apr 19 13:04:17 euler7 systemd-resolved[371]: wlan0: Bus client set DNS server list to: 1.1.1.1, 1.1.0.0
    Apr 19 13:04:17 euler7 systemd-networkd[291]: wlan0: Gained IPv6LL
    Apr 19 13:04:22 euler7 dhcpcd[382]: wlan0: leased 10.100.45.248 for 86400 seconds
    Apr 19 13:04:22 euler7 dhcpcd[382]: wlan0: adding route to 10.100.45.0/24
    Apr 19 13:04:22 euler7 dhcpcd[382]: wlan0: adding default route via 10.100.45.1
    Apr 19 13:04:29 euler7 dhcpcd[382]: wlan0: no IPv6 Routers available
    Apr 19 13:48:10 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:48:10 euler7 kernel: wlan0: deauthenticated from 6a:3a:0e:54:4c:4e (Reason: 2=PREV_AUTH_NOT_VALID)
    Apr 19 13:48:10 euler7 dhcpcd[382]: wlan0: deleting address fe80::d531:e950:9b3e:29ea
    Apr 19 13:48:10 euler7 systemd-networkd[291]: wlan0: Lost carrier
    Apr 19 13:48:10 euler7 dhcpcd[382]: wlan0: deleting route to 10.100.45.0/24
    Apr 19 13:48:10 euler7 dhcpcd[382]: wlan0: deleting default route via 10.100.45.1
    Apr 19 13:48:11 euler7 kernel: wlan0: authenticate with 6a:3a:0e:2e:ce:70
    Apr 19 13:48:11 euler7 kernel: wlan0: send auth to 6a:3a:0e:2e:ce:70 (try 1/3)
    Apr 19 13:48:11 euler7 kernel: wlan0: authenticated
    Apr 19 13:48:11 euler7 kernel: wlan0: associate with 6a:3a:0e:2e:ce:70 (try 1/3)
    Apr 19 13:48:11 euler7 kernel: wlan0: RX AssocResp from 6a:3a:0e:2e:ce:70 (capab=0x1511 status=0 aid=2)
    Apr 19 13:48:11 euler7 systemd-networkd[291]: wlan0: Connected WiFi access point: CatalystCampus-Guest (6a:3a:0e:2e:ce:70)
    Apr 19 13:48:11 euler7 kernel: wlan0: associated
    Apr 19 13:48:11 euler7 kernel: wlan0: Limiting TX power to 27 (30 - 3) dBm as advertised by 6a:3a:0e:2e:ce:70
    Apr 19 13:48:14 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:48:14 euler7 kernel: wlan0: deauthenticated from 6a:3a:0e:2e:ce:70 (Reason: 15=4WAY_HANDSHAKE_TIMEOUT)
    Apr 19 13:48:14 euler7 kernel: wlan0: authenticate with 68:3a:1e:2e:ce:70
    Apr 19 13:48:14 euler7 kernel: wlan0: 80 MHz not supported, disabling VHT
    Apr 19 13:48:14 euler7 kernel: wlan0: send auth to 68:3a:1e:2e:ce:70 (try 1/3)
    Apr 19 13:48:14 euler7 kernel: wlan0: authenticated
    Apr 19 13:48:14 euler7 kernel: wlan0: associate with 68:3a:1e:2e:ce:70 (try 1/3)
    Apr 19 13:48:14 euler7 kernel: wlan0: RX AssocResp from 68:3a:1e:2e:ce:70 (capab=0x1031 status=0 aid=4)
    Apr 19 13:48:14 euler7 kernel: wlan0: associated
    Apr 19 13:48:14 euler7 systemd-networkd[291]: wlan0: Connected WiFi access point: CatalystCampus-Guest (68:3a:1e:2e:ce:70)
    Apr 19 13:48:14 euler7 kernel: wlan0: Limiting TX power to 30 (30 - 0) dBm as advertised by 68:3a:1e:2e:ce:70
    Apr 19 13:48:18 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:48:18 euler7 kernel: wlan0: deauthenticated from 68:3a:1e:2e:ce:70 (Reason: 15=4WAY_HANDSHAKE_TIMEOUT)
    Apr 19 13:48:18 euler7 kernel: wlan0: authenticate with 68:3a:1e:2e:80:46
    Apr 19 13:48:18 euler7 kernel: wlan0: 80 MHz not supported, disabling VHT
    Apr 19 13:48:18 euler7 kernel: wlan0: send auth to 68:3a:1e:2e:80:46 (try 1/3)
    Apr 19 13:48:18 euler7 kernel: wlan0: authenticated
    Apr 19 13:48:18 euler7 kernel: wlan0: associate with 68:3a:1e:2e:80:46 (try 1/3)
    Apr 19 13:48:18 euler7 kernel: wlan0: RX AssocResp from 68:3a:1e:2e:80:46 (capab=0x1031 status=0 aid=2)
    Apr 19 13:48:18 euler7 systemd-networkd[291]: wlan0: Connected WiFi access point: CatalystCampus-Guest (68:3a:1e:2e:80:46)
    Apr 19 13:48:18 euler7 kernel: wlan0: associated
    Apr 19 13:48:18 euler7 kernel: wlan0: Limiting TX power to 30 (30 - 0) dBm as advertised by 68:3a:1e:2e:80:46
    Apr 19 13:48:22 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:48:22 euler7 kernel: wlan0: deauthenticated from 68:3a:1e:2e:80:46 (Reason: 15=4WAY_HANDSHAKE_TIMEOUT)
    Apr 19 13:48:22 euler7 kernel: wlan0: authenticate with 6a:3a:0e:2e:80:46
    Apr 19 13:48:22 euler7 kernel: wlan0: send auth to 6a:3a:0e:2e:80:46 (try 1/3)
    Apr 19 13:48:22 euler7 kernel: wlan0: authenticated
    Apr 19 13:48:22 euler7 kernel: wlan0: associate with 6a:3a:0e:2e:80:46 (try 1/3)
    Apr 19 13:48:22 euler7 kernel: wlan0: RX AssocResp from 6a:3a:0e:2e:80:46 (capab=0x1511 status=0 aid=2)
    Apr 19 13:48:22 euler7 systemd-networkd[291]: wlan0: Connected WiFi access point: CatalystCampus-Guest (6a:3a:0e:2e:80:46)
    Apr 19 13:48:22 euler7 kernel: wlan0: associated
    Apr 19 13:48:22 euler7 kernel: wlan0: Limiting TX power to 21 (24 - 3) dBm as advertised by 6a:3a:0e:2e:80:46
    Apr 19 13:48:25 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:48:25 euler7 kernel: wlan0: deauthenticated from 6a:3a:0e:2e:80:46 (Reason: 15=4WAY_HANDSHAKE_TIMEOUT)
    Apr 19 13:48:26 euler7 kernel: wlan0: authenticate with 6a:3a:0e:54:2e:f6
    Apr 19 13:48:26 euler7 kernel: wlan0: send auth to 6a:3a:0e:54:2e:f6 (try 1/3)
    Apr 19 13:48:26 euler7 kernel: wlan0: authenticated
    Apr 19 13:48:26 euler7 kernel: wlan0: associate with 6a:3a:0e:54:2e:f6 (try 1/3)
    Apr 19 13:48:26 euler7 kernel: wlan0: RX ReassocResp from 6a:3a:0e:54:2e:f6 (capab=0x1511 status=0 aid=5)
    Apr 19 13:48:26 euler7 systemd-networkd[291]: wlan0: Connected WiFi access point: CatalystCampus-Guest (6a:3a:0e:54:2e:f6)
    Apr 19 13:48:26 euler7 kernel: wlan0: associated
    Apr 19 13:48:26 euler7 kernel: wlan0: Limiting TX power to 27 (30 - 3) dBm as advertised by 6a:3a:0e:54:2e:f6
    Apr 19 13:48:29 euler7 dhcpcd[382]: wlan0: carrier lost
    Apr 19 13:48:29 euler7 kernel: wlan0: deauthenticated from 6a:3a:0e:54:2e:f6 (Reason: 15=4WAY_HANDSHAKE_TIMEOUT)
    Apr 19 13:58:42 euler7 dhcpcd[382]: wlan0: removing interface
    Apr 19 13:58:42 euler7 systemd-networkd[291]: wlan0: Link DOWN

    $ journalctl -b -1|grep -E wlan0
    Apr 19 13:59:50 euler7 systemd-networkd[301]: wlan0: Link UP
    Apr 19 13:59:52 euler7 kernel: wlan0: authenticate with 6a:3a:0e:54:4c:4e
    Apr 19 13:59:52 euler7 kernel: wlan0: send auth to 6a:3a:0e:54:4c:4e (try 1/3)
    Apr 19 13:59:52 euler7 kernel: wlan0: authenticated
    Apr 19 13:59:52 euler7 kernel: wlan0: associate with 6a:3a:0e:54:4c:4e (try 1/3)
    Apr 19 13:59:52 euler7 kernel: wlan0: RX AssocResp from 6a:3a:0e:54:4c:4e (capab=0x1511 status=0 aid=7)
    Apr 19 13:59:52 euler7 kernel: wlan0: associated
    Apr 19 13:59:52 euler7 systemd-networkd[301]: wlan0: Connected WiFi access point: CC-Platform One (6a:3a:0e:54:4c:4e)
    Apr 19 13:59:52 euler7 systemd-networkd[301]: wlan0: Gained carrier
    Apr 19 13:59:52 euler7 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
    Apr 19 13:59:52 euler7 kernel: wlan0: Limiting TX power to 27 (30 - 3) dBm as advertised by 6a:3a:0e:54:4c:4e
    Apr 19 13:59:53 euler7 systemd-resolved[378]: wlan0: Bus client set DNS server list to: 1.1.1.1, 1.1.0.0
    Apr 19 13:59:53 euler7 systemd-networkd[301]: wlan0: Gained IPv6LL
    Apr 19 14:13:09 euler7 kernel: wlan0: deauthenticating from 6a:3a:0e:54:4c:4e by local choice (Reason: 3=DEAUTH_LEAVING)

    $ journalctl -b -0|grep -E wlan0
    Apr 19 14:13:26 euler7 dhcpcd[391]: wlan0: waiting for carrier
    Apr 19 14:13:26 euler7 dhcpcd[391]: wlan0: carrier acquired
    Apr 19 14:13:26 euler7 systemd-networkd[301]: wlan0: Link UP
    Apr 19 14:13:26 euler7 dhcpcd[391]: wlan0: IAID 90:c3:bb:8a
    Apr 19 14:13:26 euler7 dhcpcd[391]: wlan0: adding address fe80::6cbb:d10:d97b:b3c
    Apr 19 14:13:26 euler7 dhcpcd[391]: wlan0: carrier lost
    Apr 19 14:13:26 euler7 dhcpcd[391]: wlan0: deleting address fe80::6cbb:d10:d97b:b3c

  Unplug Ethernet, reboot, kick wifi, plug Ethernet back in.

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    3: enp59s0u1u4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
        inet 10.100.51.180/22 brd 10.100.51.255 scope global dynamic noprefixroute enp59s0u1u4
           valid_lft 72039sec preferred_lft 63029sec
        inet6 fe80::8a9a:24c6:15db:912/64 scope link
           valid_lft forever preferred_lft forever
    4: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
        inet 10.100.45.248/24 brd 10.100.45.255 scope global dynamic noprefixroute wlan0
           valid_lft 80009sec preferred_lft 69999sec
        inet6 fe80::d531:e950:9b3e:29ea/64 scope link
           valid_lft forever preferred_lft forever

  Everything IPv4 & IPv6 got configured once.

  Seems like systemd-networkd-wait-online.service still timed out,

    Apr 19 14:50:32 euler7 systemd-networkd-wait-online[333]: Timeout occurred while waiting for network connectivity.
    Apr 19 14:50:32 euler7 systemd[1]: systemd-networkd-wait-online.service: Main process exited, code=exited, status=1/FAILURE
    Apr 19 14:50:32 euler7 systemd[1]: systemd-networkd-wait-online.service: Failed with result 'exit-code'.
    Apr 19 14:50:32 euler7 systemd[1]: Failed to start Wait for Network to be Configured.

  while dhcpcd, systemd-networkd, and maybe the kernel too were interacting with
  wifi and Ethernet interfaces.

    Apr 19 14:49:35 euler7 dhcpcd[392]: wlan0: waiting for carrier
    Apr 19 14:49:36 euler7 kernel: wlan0: authenticate with 6a:3a:0e:54:4c:4e
    Apr 19 14:49:36 euler7 kernel: wlan0: send auth to 6a:3a:0e:54:4c:4e (try 1/3)
    Apr 19 14:49:36 euler7 kernel: wlan0: authenticated
    Apr 19 14:49:36 euler7 kernel: wlan0: associate with 6a:3a:0e:54:4c:4e (try 1/3)
    Apr 19 14:49:36 euler7 kernel: wlan0: RX AssocResp from 6a:3a:0e:54:4c:4e (capab=0x1511 status=0 aid=1)
    Apr 19 14:49:36 euler7 kernel: iwlwifi 0000:00:14.3: Got NSS = 8 - trimming to 2
    Apr 19 14:49:36 euler7 kernel: wlan0: associated
    Apr 19 14:49:36 euler7 systemd-networkd[304]: wlan0: Connected WiFi access point: CC-Platform One (6a:3a:0e:54:4c:4e)
    Apr 19 14:49:36 euler7 kernel: wlan0: Limiting TX power to 27 (30 - 3) dBm as advertised by 6a:3a:0e:54:4c:4e
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: carrier acquired
    Apr 19 14:49:37 euler7 systemd-networkd[304]: wlan0: Gained carrier
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: connected to Access Point: CC-Platform One
    Apr 19 14:49:37 euler7 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: IAID 90:c3:bb:8a
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: adding address fe80::d531:e950:9b3e:29ea
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: soliciting an IPv6 router
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: rebinding lease of 10.100.45.248
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: probing address 10.100.45.248/24
    Apr 19 14:49:38 euler7 systemd-networkd[304]: wlan0: Gained IPv6LL
    Apr 19 14:49:38 euler7 systemd-timesyncd[385]: Network configuration changed, trying to establish connection.
    Apr 19 14:49:42 euler7 dhcpcd[392]: wlan0: leased 10.100.45.248 for 80080 seconds
    Apr 19 14:49:42 euler7 dhcpcd[392]: wlan0: adding route to 10.100.45.0/24
    Apr 19 14:49:42 euler7 dhcpcd[392]: wlan0: adding default route via 10.100.45.1
    Apr 19 14:49:42 euler7 systemd-timesyncd[385]: Network configuration changed, trying to establish connection.
    Apr 19 14:49:50 euler7 dhcpcd[392]: wlan0: no IPv6 Routers available
    Apr 19 14:50:07 euler7 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): enp59s0u1u4: link becomes ready
    Apr 19 14:50:07 euler7 kernel: r8152 4-1.4:1.0 enp59s0u1u4: carrier on
    Apr 19 14:50:07 euler7 dhcpcd[392]: enp59s0u1u4: carrier acquired
    Apr 19 14:50:07 euler7 systemd-networkd[304]: enp59s0u1u4: Gained carrier
    Apr 19 14:50:07 euler7 systemd-timesyncd[385]: Network configuration changed, trying to establish connection.
    Apr 19 14:50:07 euler7 dhcpcd[392]: enp59s0u1u4: IAID 4c:68:22:1e
    Apr 19 14:50:07 euler7 dhcpcd[392]: enp59s0u1u4: adding address fe80::8a9a:24c6:15db:912
    Apr 19 14:50:07 euler7 systemd-timesyncd[385]: Initial synchronization to time server 204.2.134.163:123 (2.arch.pool.ntp.org).
    Apr 19 14:50:08 euler7 dhcpcd[392]: enp59s0u1u4: soliciting an IPv6 router
    Apr 19 14:50:09 euler7 systemd-networkd[304]: enp59s0u1u4: Gained IPv6LL
    Apr 19 14:50:09 euler7 dhcpcd[392]: enp59s0u1u4: rebinding lease of 10.100.51.180
    Apr 19 14:50:09 euler7 dhcpcd[392]: enp59s0u1u4: probing address 10.100.51.180/22
    Apr 19 14:50:13 euler7 dhcpcd[392]: enp59s0u1u4: leased 10.100.51.180 for 72078 seconds
    Apr 19 14:50:13 euler7 dhcpcd[392]: enp59s0u1u4: adding route to 10.100.48.0/22
    Apr 19 14:50:13 euler7 dhcpcd[392]: enp59s0u1u4: adding default route via 10.100.50.1
    Apr 19 14:50:21 euler7 dhcpcd[392]: enp59s0u1u4: no IPv6 Routers available
    Apr 19 14:49:37 euler7 dhcpcd[392]: wlan0: probing address 10.100.45.248/24
    Apr 19 14:49:38 euler7 systemd-networkd[304]: wlan0: Gained IPv6LL
    Apr 19 14:49:38 euler7 systemd-timesyncd[385]: Network configuration changed, trying to establish connection.
    Apr 19 14:49:42 euler7 dhcpcd[392]: wlan0: leased 10.100.45.248 for 80080 seconds
    Apr 19 14:49:42 euler7 dhcpcd[392]: wlan0: adding route to 10.100.45.0/24
    Apr 19 14:49:42 euler7 dhcpcd[392]: wlan0: adding default route via 10.100.45.1
    Apr 19 14:49:42 euler7 systemd-timesyncd[385]: Network configuration changed, trying to establish connection.
    Apr 19 14:49:50 euler7 dhcpcd[392]: wlan0: no IPv6 Routers available
    Apr 19 14:50:07 euler7 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): enp59s0u1u4: link becomes ready
    Apr 19 14:50:07 euler7 kernel: r8152 4-1.4:1.0 enp59s0u1u4: carrier on
    Apr 19 14:50:07 euler7 dhcpcd[392]: enp59s0u1u4: carrier acquired
    Apr 19 14:50:07 euler7 systemd-networkd[304]: enp59s0u1u4: Gained carrier
    Apr 19 14:50:07 euler7 systemd-timesyncd[385]: Network configuration changed, trying to establish connection.
    Apr 19 14:50:07 euler7 dhcpcd[392]: enp59s0u1u4: IAID 4c:68:22:1e
    Apr 19 14:50:07 euler7 dhcpcd[392]: enp59s0u1u4: adding address fe80::8a9a:24c6:15db:912
    Apr 19 14:50:07 euler7 systemd-timesyncd[385]: Initial synchronization to time server 204.2.134.163:123 (2.arch.pool.ntp.org).
    Apr 19 14:50:08 euler7 dhcpcd[392]: enp59s0u1u4: soliciting an IPv6 router
    Apr 19 14:50:09 euler7 systemd-networkd[304]: enp59s0u1u4: Gained IPv6LL
    Apr 19 14:50:09 euler7 dhcpcd[392]: enp59s0u1u4: rebinding lease of 10.100.51.180
    Apr 19 14:50:09 euler7 dhcpcd[392]: enp59s0u1u4: probing address 10.100.51.180/22
    Apr 19 14:50:13 euler7 dhcpcd[392]: enp59s0u1u4: leased 10.100.51.180 for 72078 seconds
    Apr 19 14:50:13 euler7 dhcpcd[392]: enp59s0u1u4: adding route to 10.100.48.0/22
    Apr 19 14:50:13 euler7 dhcpcd[392]: enp59s0u1u4: adding default route via 10.100.50.1
    Apr 19 14:50:21 euler7 dhcpcd[392]: enp59s0u1u4: no IPv6 Routers available
    Apr 19 14:50:32 euler7 systemd-networkd-wait-online[333]: Timeout occurred while waiting for network connectivity.
    Apr 19 14:50:32 euler7 systemd[1]: systemd-networkd-wait-online.service: Main process exited, code=exited, status=1/FAILURE
    Apr 19 14:50:32 euler7 systemd[1]: systemd-networkd-wait-online.service: Failed with result 'exit-code'.
    Apr 19 14:50:32 euler7 systemd[1]: Failed to start Wait for Network to be Configured.
    Apr 19 14:50:32 euler7 audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 msg='unit=systemd-networkd-wait-online comm="systemd" exe="/usr/lib/systemd/system>
    Apr 19 14:50:32 euler7 systemd[1]: Reached target Network is Online.

  while the system was still configuring the interface.

  OK ... dhcpcd and systemd-networkd both can't be running.  Let's try
  turning off systemd-networkd.

    $ sudo systemctl disable systemd-networkd.service

  Reboot, reboot, reboot....

  Prefers Ethernet over wireless.  If cable or USB-C disconnected in the
  beginning, only a

    $ iwctl adapter list

  is needed to bootstrap wireless.  If Ethernet removed, need to
  go through the whole manual wifi process to bring wireless back.

    $ resolvectl query ...
    $ getent hosts ...

  both seem to reliably work when either using wireless or Ethernet.

  Last thing I want to try is to enable wireless configuration via
  iwd again.  If it works, maybe bringing back wireless will be
  more robust.  If not, there may be some configurations I could
  give dhcpcd to make it play nicely with iwd.

  Reboot ... nope, getting double IPv4 addresses again.

  Now, outside of sway, it prefers Ethernet over Wireless, but
  seemlessly switches betwwen the two when Ethernet cable or
  USB-C cable gets disconnected.

  Reboot with Ethernet cable attached

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    2: wlan0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
    3: enp59s0u1u4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
        inet 10.100.51.180/22 brd 10.100.51.255 scope global dynamic noprefixroute enp59s0u1u4
           valid_lft 83229sec preferred_lft 72817sec
        inet6 fe80::8a9a:24c6:15db:912/64 scope link
           valid_lft forever preferred_lft forever

  Disconnect Ethernet cable

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    2: wlan0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
    3: enp59s0u1u4: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff

  "Kick Wifi"

    $ iwctl adapter list
    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    3: enp59s0u1u4: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
    4: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
        inet 10.100.45.248/24 brd 10.100.45.255 scope global dynamic noprefixroute wlan0
           valid_lft 67639sec preferred_lft 59168sec
        inet6 fe80::d531:e950:9b3e:29ea/64 scope link
           valid_lft forever preferred_lft forever

 Plug Ethernet back in

    $ ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
           valid_lft forever preferred_lft forever
    3: enp59s0u1u4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
        link/ether 00:e0:4c:68:22:1e brd ff:ff:ff:ff:ff:ff
        inet 10.100.51.180/22 brd 10.100.51.255 scope global dynamic noprefixroute enp59s0u1u4
           valid_lft 82898sec preferred_lft 72533sec
        inet6 fe80::8a9a:24c6:15db:912/64 scope link
           valid_lft forever preferred_lft forever
    4: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
        link/ether 08:71:90:c3:bb:8a brd ff:ff:ff:ff:ff:ff
        inet 10.100.45.248/24 brd 10.100.45.255 scope global dynamic noprefixroute wlan0
           valid_lft 67568sec preferred_lft 59097sec
        inet6 fe80::d531:e950:9b3e:29ea/64 scope link
           valid_lft forever preferred_lft forever

  Now unplug and replug the cable and network seemlessly shifts between the two.

  Lets configure gauss17 the same way and sees how it behaves in my apartment.

2022-04-20:
  Comparing gauss17 with euler7.

  Reinstalling systemd resolvconf replacement (for use with systemd-resolved).

    $ sudo pacman -Syu systemd-resolvconf

2022-04-27:
  As was done on gauss17, iwd enabled.

    $ sudo systemctl enable iwd
    Created symlink /etc/systemd/system/multi-user.target.wants/iwd.service → /usr/lib/systemd/system/iwd.service.

  This finally fixes the wifi problem.  See gauss17ArchLinuxAdmin.log for details.

2022-04-27:
  Try and get network printer working with CUPS.

  Printer is Konica Minolta bizhub C300i.  Downloaded *.ppd
  files from manufacture's website.

    $ ls
    KOC750iopn.ppd  KOC750iUX.ppd

    $ sudo cp KOC750i* /usr/share/cups/model

  Now,

    $ lpinfo -m|grep -i konica

  shows the ppd files along with a bunch of other Konica Minolta
  printers from foomatic package.

  Printer is on 10.54.10.2/24 while euler7 is on 10.54.2.6/24.  All
  attemps at pinging it and lpr commands are failing.  Totally
  don't know what I am doing.

  Try avahi out of desparation?

2020-04-27:
  Installing avahi onto euler7.

    $ sudo pacman -Syu nss-mdns

  Editted /etc/nsswitch.conf (via dotfiles) to modify line from

    hosts: mymachines resolve [!UNAVAIL=return] files myhostname dns

  to

    hosts: mymachines mdns4_minimal [NOTFOUND=return] resolve [!UNAVAIL=return] \
           files myhostname dns mdns4

  then enable avahi

    $ sudo systemctl enable avahi-daemon.service
    Created symlink /etc/systemd/system/dbus-org.freedesktop.Avahi.service → /usr/lib/systemd/system/avahi-daemon.service.
    Created symlink /etc/systemd/system/multi-user.target.wants/avahi-daemon.service → /usr/lib/systemd/system/avahi-daemon.service.
    Created symlink /etc/systemd/system/sockets.target.wants/avahi-daemon.socket → /usr/lib/systemd/system/avahi-daemon.socket.

  and finally disable mDNS in systemd-resolved

    $ cat resolved.conf|grep -v '^#'

    [Resolve]
    DNSSEC=allow-downgrade
    MulticastDNS=no

  I also turned on DNSSEC, but allowed it to be downgradable (I am not
  trying to debug the Internet).

  Reboot.

  See https://brainxploit.com/how-to-set-up-avahi-on-arch-linux/ for
  some examples on how to test out avahi.

    $ systemctl status
    ● euler7
        State: running
         Jobs: 0 queued
       Failed: 0 units
        Since: Wed 2022-04-27 18:26:43 MDT; 2min 45s ago
       CGroup: /
               ├─init.scope
               │ └─1 /sbin/init
               ├─system.slice
               │ ├─avahi-daemon.service
               │ │ ├─365 "avahi-daemon: running [euler7.local]"
               │ │ └─375 "avahi-daemon: chroot helper"
               │ ├─bluetooth.service
               │ │ └─524 /usr/lib/bluetooth/bluetoothd
               │ ├─dbus.service
               │ │ └─366 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
               │ ├─dhcpcd.service
               │ │ ├─370 "dhcpcd: [manager] [ip4] [ip6]"
               │ │ ├─371 "dhcpcd: [privileged proxy]"
               │ │ ├─372 "dhcpcd: [network proxy]"
               │ │ ├─373 "dhcpcd: [control proxy]"
               │ │ ├─566 "dhcpcd: [BPF ARP] wlan0 10.247.100.161"
               │ │ └─584 "dhcpcd: [BPF ARP] enp59s0u1u4 10.54.2.6"
               │ ├─iwd.service
               │ │ └─368 /usr/lib/iwd/iwd
               │ ├─polkit.service
               │ │ └─965 /usr/lib/polkit-1/polkitd --no-debug
               │ ├─rtkit-daemon.service
               │ │ └─1063 /usr/lib/rtkit-daemon
               │ ├─sshd.service
               │ │ └─500 "sshd: /usr/bin/sshd -D [listener] 0 of 10-100 startups"
               │ ├─systemd-homed.service
               │ │ └─378 /usr/lib/systemd/systemd-homed
               │ ├─systemd-hostnamed.service
               │ │ └─1288 /usr/lib/systemd/systemd-hostnamed
               │ ├─systemd-journald.service
               │ │ └─252 /usr/lib/systemd/systemd-journald
               │ ├─systemd-logind.service
               │ │ └─374 /usr/lib/systemd/systemd-logind
               │ ├─systemd-resolved.service
               │ │ └─357 /usr/lib/systemd/systemd-resolved
               │ ├─systemd-timesyncd.service
               │ │ └─358 /usr/lib/systemd/systemd-timesyncd
               │ ├─systemd-udevd.service
               │ │ └─272 /usr/lib/systemd/systemd-udevd
               │ └─systemd-userdbd.service
               │   ├─267 /usr/lib/systemd/systemd-userdbd
               │   ├─354 systemd-userwork
               │   ├─355 systemd-userwork
               │   └─356 systemd-userwork
               └─user.slice

  Let's see what services might be running,

    $ avahi-browse --all --resolve --terminate
    $

  Nobody home at work.

  Let's see if DNSSEC works at work.

    $ resolvectl query sigok.verteiltesysteme.net
    sigok.verteiltesysteme.net: 134.91.78.139      -- link: enp59s0u1u4
                                2001:638:501:8efc::139 -- link: enp59s0u1u4

    -- Information acquired via protocol DNS in 440.3ms.
    -- Data is authenticated: yes; Data was acquired via local or encrypted transport: no
    -- Data from: network

    $ resolvectl query sigfail.verteiltesysteme.net
    sigfail.verteiltesysteme.net: resolve call failed: DNSSEC validation failed: invalid

    $ resolvectl query google.com
    google.com: 2607:f8b0:4000:800::200e           -- link: enp59s0u1u4
                216.58.193.142                     -- link: enp59s0u1u4

    -- Information acquired via protocol DNS in 118.3ms.
    -- Data is authenticated: no; Data was acquired via local or encrypted transport: no
    -- Data from: network

    $ resolvectl query gitlab.com
    gitlab.com: 172.65.251.78                      -- link: enp59s0u1u4
                2606:4700:90:0:f22e:fbec:5bed:a9b9 -- link: enp59s0u1u4

    -- Information acquired via protocol DNS in 80.1ms.
    -- Data is authenticated: no; Data was acquired via local or encrypted transport: no
    -- Data from: network

2022-05-04:
  Remove vscode, I have no desire to use the tool and its
  electron updated take forever to install.

  $ sudo pacman -Rsc code electron electron13 electron17
    checking dependencies...

    Packages (4) code-1.66.0-2  electron-18.2.0-1  electron13-13.6.9-3
                 electron17-17.4.0-2

2022-05-04:
  Disable systemd-homed.service,

    $ sudo systemctl stop systemd-homed.service
    $ sudo systemctl disable systemd-homed.service

2022-05-04:
  Reading the RTFM manpages on CUPS printing.

  CUPS has a web interface: http://localhost:631

  Was able to configure printer, similar to GUI printer interfaces.

    $ lpr hw
    lpr: Error - No default destination.

    $ lpstat -t
    scheduler is running
    no system default destination
    device for BIZHUB-C300I: ipp://10.54.10.2/ipp
    BIZHUB-C300I accepting requests since Wed 04 May 2022 03:46:57 PM MDT
    printer BIZHUB-C300I is idle.  enabled since Wed 04 May 2022 03:46:57 PM MDT

  How to add a default printer?

2022-05-05:
  Finish setting up printer.

  Print to printer by name,

    $ lpr -P BIZHUB-C300I hw.txt

  Printing worked!

  Now, set up default printer

    $ lpstat -d
    no system default destination

    $ lpadmin -d BIZHUB-C300I

    $ lpstat -d
    system default destination: BIZHUB-C300I

    $ lpr hw.txt

  Worked!

2022-05-28:
  Cleaned up /home/grs/.config directory.  Used corresponding one
  on gauss17 as a guide.

2022-05-31:
  Installed bind package for nslookup,

    $ sudo pacman -Syu bind

  Installed qt6 wayland infrastructure (to match gauss17).

    $ sudo pacman -Syu qt6-wayland
    :: Synchronizing package databases...
     core is up to date
     extra is up to date
     community is up to date
     archlocal is up to date
    :: Starting full system upgrade...
    resolving dependencies...
    looking for conflicting packages...

    Packages (7) libb2-0.98.1-2  qt6-base-6.3.0-3  qt6-declarative-6.3.0-2
                 qt6-translations-6.3.0-1  vulkan-headers-1:1.3.213-1
                 xcb-util-cursor-0.1.3-4  qt6-wayland-6.3.0-1

2022-05-31:
  Made similar Neovim repairs as I did on gauss17 on 05-30 & 05-31.

2022-05-31:
  Installed qt6ct configuration tool.

    $ sudo pacman -Syu qt6ct

2022-06-01:
  Install some LSP language servers and associated plugins
  from the Arch repos.  The plugins are for the Haskell language
  server.

    $ sudo pacman -Syu lua-language-server typescript-language-server \
        yaml-language-server haskell-language-server \
        haskell-hls-call-hierarchy-plugin haskell-hls-eval-plugin \
        haskell-hls-explicit-imports-plugin haskell-hls-graph \
        haskell-hls-haddock-comments-plugin haskell-hls-hlint-plugin \
        haskell-hls-module-name-plugin haskell-hls-plugin-api \
        haskell-hls-pragmas-plugin haskell-hls-retrie-plugin \
        haskell-hls-test-utils

  Will need to update Neovim configuration from my dotfiles repo.

2022-07-11:
  Removed qt version of pavucontrol.

    $ sudo pacman -Rsc pavucontrol-qt

  The gtk version is playing nicer with sway dark mode themes.

2022-08-10:
  Redoing Haskell infrastructure.  Aiming at a native Arch Haskell
  Cabal based shared library experience.

    $ sudo pacman -Rsc (pacman -Qsq 'haskell|ghc|^stack$|^cabal-install$')
    $ sudo pacman -Syu ghc haskell-language-server cabal-install

2022-09-14:
  Need to sync up all the changes made on gauss17 here on euler7.

  See if coursier is installed for nvim-metals.

    $ pacman -Ss coursier
    archlocal/coursier 2.1.0_M1-1 [installed]
        Pure Scala Artifact Fetching

  Need to update my archlocal repo to what I have on gauss17

    $ cd ~/build
    $ rsync -av --delete gauss17:build/ArchLocalRepo .
    $ sudo pacman -Syu

  Check coursier version again

    $ pacman -Ss coursier
    archlocal/coursier 2.1.0_M6-1 [installed]
        Pure Scala Artifact Fetching

  Check if dash installed

    $ pacman -Ss '^dash$'
    core/dash 0.5.11.5-1 [installed]
        POSIX compliant shell that aims to be as small as possible

  Update /bin/sh symlink to use dash

    $ sudo rm /usr/bin/bash
    $ sudo ln -s dash /usr/bin/sh
    $ ll /usr/bin/sh
    lrwxrwxrwx 1 root root 4 Sep 15 00:18 /usr/bin/sh -> dash*

  Add shellcheck linter to euler7

    $ sudo pacman -Syu shellcheck

  Finally, update latest grscheller/dotfiles changes

    $ cd ~/devel/dotfiles/
    $ git fetch
    $ git status
    On branch main
    Your branch is behind 'origin/main' by 15 commits, and can be fast-forwarded.
      (use "git pull" to update your local branch)

    nothing to commit, working tree clean
    $ git pull
    $ .dotfilesInstall
    $ sudo ./systemflesInstall
    $ cd; unguard_universals; REDO_ENV=yes fish -l

  Now reboot.

2022-09-15::qt6::qt6
  Finally got the Neovim::Ext module installed for Neovim.

  Was installed here: ~/perl5/lib/perl5/Neovim/

    $ sudo pacman -Syu cpanminus
    $ cpanm -n Neovim::Ext

  The cparm command really wanted to install things to
  /usr/share/per5/site_perl/ and /usr/bin/

    $ cpanm -n Neovim::Ext
    !
    ! Can't write to /usr/share/perl5/site_perl and /usr/bin: Installing modules to /home/grs/perl5
    ! To turn off this warning, you have to do one of the following:
    !   - run me as a root or with --sudo option (to install to /usr/share/perl5/site_perl and /usr/bin)
    !   - Configure local::lib in your existing shell to set PERL_MM_OPT etc.
    !   - Install local::lib by running the following commands
    !
    !         cpanm --local-lib=~/perl5 local::lib && eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)
    !
    Neovim::Ext is up to date. (0.05)

  If I were running perl code on a production system, I would never run
  any perl modules as the root user that did not come with the Linux
  Distribution.

2022-09-27:
  Installing MozillaVPN onto euler7.

  First update local copy of my archlocal repo on euler7.  At some point
  I should figure out how to run the repo from gauss17.

    $ cd ~/build/
    $ rsync -av --delete gauss17:build/ArchLocalRepo .
    receiving incremental file list
    ArchLocalRepo/
    ArchLocalRepo/archlocal.db.tar.xz
    ArchLocalRepo/archlocal.files.tar.xz
    ArchLocalRepo/mozillavpn-2.9.0-1-x86_64.pkg.tar.zst

    sent 115 bytes  received 4,163,323 bytes  2,775,625.33 bytes/sec
    total size is 53,586,026  speedup is 12.87

    $ sudo pacman -Syu
    ...

    $ sudo pacman -Syu mozillavpn
    :: Synchronizing package databases...
     core is up to date
     extra is up to date
     community is up to date
     archlocal is up to date
    :: Starting full system upgrade...
    resolving dependencies...
    looking for conflicting packages...

    Packages (8) libmng-2.0.3-3  qt6-5compat-6.3.2-1  qt6-charts-6.3.2-1
                 qt6-imageformats-6.3.2-1  qt6-networkauth-6.3.2-1  qt6-websockets-6.3.2-1
                 wireguard-tools-1.0.20210914-1  mozillavpn-2.9.0-1

    Total Download Size:    5.58 MiB
    Total Installed Size:  16.62 MiB

    :: Proceed with installation? [Y/n]
    ...

    $ sudo systemctl enable mozillavpn.service
    $ sudo systemctl start mozillavpn.service

2022-10-03:
  Uninstalled mozillavpn, rsync'ed archlocal repo, reinstalled it.  Had to
  manually inxtall qt6-shadertools.  Next step is to see if I can correctly
  update my mozillavpn package to take this new dependency into effect.

2023-01-19:
  Pacman update failed.  Probably due to going a month without an update.

  When I did a

    $ sudo pazcman -Syu

  I got the following error message

    error: openssl signature from "Pierre Schmitz <pierre@archlinux.org>" is marginal trust
    :: File /mnt/var/cache/pacman/pkg/openssl-3.0.7-4-x86_64.pkg.tar.zst is corrupted (invalid or corrupted package (PGP signature)).

  due to openssl signatures being out of date.  These were update sometime in
  around Dec 20.  To get around this I had to do a "partial" update to get
  the current archlinux-keyring, before doing the full upgrade.

    $ sudo pacman -Sy archlinux-keyring
    $ sudo pazcman -Syu

  that fixed the issue.

  Note: never do a "pacman -Sy" without following up with a "pacman -Syu"

2023-01-30:
  Repeated fix done on gauss17 involving VA-API test failure from Firefox.

    $ sudo pacman -Syu libva-intel-driver intel-media-driver

  Since work computer does not have 32-bit drivers, I did not
  install the lib32-libva-intel-driver.

2023-01-31:
  Reading a book about functional programming.  Examples given in
  OCaml and Haskell.  Need to install OCaml infrastucture.

    $ pacman -Sg

  does not show any sort of "OCaml" package.

    $ pacman -Ssq ocaml
    ocaml
    ocaml-bigarray-compat
    ocaml-compiler-libs
    ocaml-ctypes
    ocaml-integers
    ocaml-result
    ocaml-topkg
    camlp5
    dune
    ocaml-base
    ocaml-cairo
    ocaml-csexp
    ocaml-findlib
    ocaml-hashcons
    ocaml-lablgl
    ocaml-num
    ocaml-pp
    ocaml-ppx_derivers
    ocaml-sexplib0
    ocaml-stdio
    ocaml-stdlib-shims
    ocaml-zarith
    ocamlbuild
    opam

  opam: OCaml package manager
  dune: Composable build sustem for OCaml (formally jbuilder)
  ocaml-topkg: A packager for distributing OCaml software

  Lets install this stuff

    $ sudo pacman -Syu (pacman -Ssq ocaml)
    :: Synchronizing package databases...
     core is up to date
     extra is up to date
     community is up to date
     multilib is up to date
     archlocal is up to date
    :: Starting full system upgrade...
    resolving dependencies...
    looking for conflicting packages...

    Packages (27) \
    camlp-streams-5.0.1-1  gtk2-2.24.33-2  lablgtk2-2.18.12-2
    camlp5-8.0-4  dune-3.6.2-1  ocaml-4.14.0-1
    ocaml-base-0.15.0-2  ocaml-bigarray-compat-1.0.0-3
    ocaml-cairo-0.6.4-1  ocaml-compiler-libs-4.14.0-1
    ocaml-csexp-1.5.1-5  ocaml-ctypes-0.20.1-1
    ocaml-findlib-1.9.6-1  ocaml-hashcons-1.3-5
    ocaml-integers-0.7.0-1  ocaml-lablgl-1.06-12
    ocaml-num-1.4-6  ocaml-pp-1.1.2-3
    ocaml-ppx_derivers-1.2.1-9  ocaml-result-1.5-7
    ocaml-sexplib0-0.15.1-2  ocaml-stdio-0.15.0-2
    ocaml-stdlib-shims-0.3.0-5  ocaml-topkg-1.0.5-1
    ocaml-zarith-1.12-5  ocamlbuild-0.14.2-1  opam-2.1.4-1

  Dumping some output here to be added to a OCaml admin log
  later.

$ opam init
No configuration file found, using built-in defaults.
Checking for available remotes: rsync and local, git.
  - you won't be able to use mercurial repositories unless you install
    the hg command on your system.
  - you won't be able to use darcs repositories unless you install the
    darcs command on your system.


<><> Fetching repository information ><><><><><><><><><><><><><><><><><>
[default] Initialised

<><> Required setup - please read <><><><><><><><><><><><><><><><><><><>

  In normal operation, opam only alters files within ~/.opam.

  However, to best integrate with your system, some environment variables
  should be set. If you allow it to, this initialisation step will update
  your fish configuration by adding the following line to ~/.config/fish/config.fish:

    source /home/grs/.opam/opam-init/init.fish > /dev/null 2> /dev/null; or true

  Otherwise, every time you want to access your opam installation, you will
  need to run:

    eval (opam env)

  You can always re-run this setup with 'opam init' later.

Do you want opam to modify ~/.config/fish/config.fish? [N/y/f]
(default is 'no', use 'f' to choose a different file) y

User configuration:
  Updating ~/.config/fish/config.fish.

<><> Creating initial switch 'default' (invariant ["ocaml" {>= "4.05.0"}] - initially with ocaml-system)

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><>
Switch invariant: ["ocaml" {>= "4.05.0"}]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><>
∗ installed base-bigarray.base
∗ installed base-threads.base
∗ installed base-unix.base
∗ installed ocaml-system.4.14.0
∗ installed ocaml-config.2
∗ installed ocaml.4.14.0
Done.
# Run eval (opam env --switch=default) to update the current shell
environment

*** Should have done above before next step????  Looks like it is
*** installing everything locally.

$ opam install utop
The following actions will be performed:
  ∗ install ocamlfind         1.9.5  [required by utop]
  ∗ install dune              3.6.1  [required by utop]
  ∗ install ocamlbuild        0.14.2 [required by logs]
  ∗ install base-bytes        base   [required by ocplib-endian]
  ∗ install trie              1.0.0  [required by mew]
  ∗ install result            1.5    [required by zed]
  ∗ install csexp             1.5.1  [required by dune-configurator]
  ∗ install cppo              1.6.9  [required by utop]
  ∗ install uchar             0.0.2  [required by zed]
  ∗ install topkg             1.0.6  [required by logs]
  ∗ install mew               0.1.0  [required by mew_vi]
  ∗ install dune-configurator 3.6.1  [required by lwt]
  ∗ install ocplib-endian     1.2    [required by lwt]
  ∗ install uutf              1.0.3  [required by zed]
  ∗ install react             1.2.2  [required by utop]
  ∗ install lwt               5.6.1  [required by utop]
  ∗ install uucp              15.0.0 [required by zed]
  ∗ install mew_vi            0.5.0  [required by lambda-term]
  ∗ install lwt_react         1.2.0  [required by utop]
  ∗ install logs              0.7.0  [required by utop]
  ∗ install uuseg             15.0.0 [required by zed]
  ∗ install zed               3.2.1  [required by utop]
  ∗ install lambda-term       3.3.1  [required by utop]
  ∗ install utop              2.11.0
===== ∗ 24 =====
Do you want to continue? [Y/n] y

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><>
⬇ retrieved csexp.1.5.1  (https://opam.ocaml.org/cache)
⬇ retrieved cppo.1.6.9  (https://opam.ocaml.org/cache)
⬇ retrieved lambda-term.3.3.1  (https://opam.ocaml.org/cache)
⬇ retrieved dune.3.6.1  (https://opam.ocaml.org/cache)
⬇ retrieved logs.0.7.0  (https://opam.ocaml.org/cache)
⬇ retrieved lwt.5.6.1  (https://opam.ocaml.org/cache)
⬇ retrieved mew.0.1.0  (https://opam.ocaml.org/cache)
⬇ retrieved lwt_react.1.2.0  (https://opam.ocaml.org/cache)
⬇ retrieved mew_vi.0.5.0  (https://opam.ocaml.org/cache)
⬇ retrieved dune-configurator.3.6.1  (https://opam.ocaml.org/cache)
⬇ retrieved ocamlbuild.0.14.2  (https://opam.ocaml.org/cache)
⬇ retrieved ocamlfind.1.9.5  (https://opam.ocaml.org/cache)
[ERROR] The compilation of ocamlbuild.0.14.2 failed at "make
        check-if-preinstalled all opam-install".
⬇ retrieved result.1.5  (https://opam.ocaml.org/cache)
⬇ retrieved ocplib-endian.1.2  (https://opam.ocaml.org/cache)
⬇ retrieved react.1.2.2  (https://opam.ocaml.org/cache)
⬇ retrieved trie.1.0.0  (https://opam.ocaml.org/cache)
⬇ retrieved uchar.0.0.2  (https://opam.ocaml.org/cache)
⬇ retrieved topkg.1.0.6  (https://opam.ocaml.org/cache)
⬇ retrieved uuseg.15.0.0  (https://opam.ocaml.org/cache)
⬇ retrieved utop.2.11.0  (https://opam.ocaml.org/cache)
⬇ retrieved uutf.1.0.3  (https://opam.ocaml.org/cache)
⬇ retrieved uucp.15.0.0  (https://opam.ocaml.org/cache)
⬇ retrieved zed.3.2.1  (https://opam.ocaml.org/cache)
∗ installed ocamlfind.1.9.5
∗ installed base-bytes.base
∗ installed dune.3.6.1
∗ installed trie.1.0.0
∗ installed result.1.5
∗ installed csexp.1.5.1
∗ installed mew.0.1.0
∗ installed cppo.1.6.9
∗ installed ocplib-endian.1.2
∗ installed dune-configurator.3.6.1
∗ installed lwt.5.6.1

#=== ERROR while compiling ocamlbuild.0.14.2 ==========================#
# context     2.1.4 | linux/x86_64 | ocaml.4.14.0 | https://opam.ocaml.org#bf34c78d
# path        ~/.opam/default/.opam-switch/build/ocamlbuild.0.14.2
# command     ~/.opam/opam-init/hooks/sandbox.sh build make check-if-preinstalled all opam-install
# exit-code   2
# env-file    ~/.opam/log/ocamlbuild-9734-0d2c44.env
# output-file ~/.opam/log/ocamlbuild-9734-0d2c44.out
### output ###
# if test -d /usr/lib/ocaml/ocamlbuild; then\
#   >&2 echo "ERROR: Preinstalled ocamlbuild detected at"\
#        "/usr/lib/ocaml/ocamlbuild";\
#   >&2 echo "Installation aborted; if you want to bypass this"\
#         "safety check, pass CHECK_IF_PREINSTALLED=false to make";\
#   exit 2;\
# fi
# ERROR: Preinstalled ocamlbuild detected at /usr/lib/ocaml/ocamlbuild
# Installation aborted; if you want to bypass this safety check, pass CHECK_IF_PREINSTALLED=false to make
# make: *** [Makefile:410: check-if-preinstalled] Error 2



<><> Error report <><><><><><><><><><><><><><><><><><><><><><><><><><><>
┌─ The following actions failed
│ λ build ocamlbuild 0.14.2
└─
┌─ The following changes have been performed (the rest was aborted)
│ ∗ install base-bytes        base
│ ∗ install cppo              1.6.9
│ ∗ install csexp             1.5.1
│ ∗ install dune              3.6.1
│ ∗ install dune-configurator 3.6.1
│ ∗ install lwt               5.6.1
│ ∗ install mew               0.1.0
│ ∗ install ocamlfind         1.9.5
│ ∗ install ocplib-endian     1.2
│ ∗ install result            1.5
│ ∗ install trie              1.0.0
└─
# Run eval (opam env) to update the current shell environment

The former state can be restored with:
    /usr/bin/opam switch import
"/home/grs/.opam/default/.opam-switch/backup/state-20230131222009.export"



*** Let's see what it did to my config.fish
$ $DOTFILE_GIT_REPO/dfInstall -c target

Target: '/home/grs/.config/alacritty/alacritty_arch.yml' doesn't exist.

Target: '/home/grs/.config/fish/config.fish' differs from
Source: '/home/grs/devel/dotfiles/config/fish/config.fish'.

Target: '/home/grs/.config/sway/config' differs from
Source: '/home/grs/devel/dotfiles/config/sway/config'.

$ diff devel/dotfiles/config/fish/config.fish .config/fish/config.fish
142a143,145
>
> # opam configuration
> source /home/grs/.opam/opam-init/init.fish > /dev/null 2> /dev/null; or true

*** Will need to redo this, but will get it working on
*** gauss17 first.

$ opam init

<><> Required setup - please read <><><><><><><><><><><><><><><><><><><>

  In normal operation, opam only alters files within ~/.opam.

  However, to best integrate with your system, some environment variables
  should be set. If you allow it to, this initialisation step will update
  your fish configuration by adding the following line to ~/.config/fish/config.fish:

    source /home/grs/.opam/opam-init/init.fish > /dev/null 2> /dev/null; or true

  Otherwise, every time you want to access your opam installation, you will
  need to run:

    eval (opam env)

  You can always re-run this setup with 'opam init' later.

Do you want opam to modify ~/.config/fish/config.fish? [N/y/f]
(default is 'no', use 'f' to choose a different file) N
A hook can be added to opam's init scripts to ensure that the shell
remains in sync with the opam environment when they are loaded. Set
that up? [y/N] y

2023-02-08:
  Installing Kanshi package from community to make Wayland "hot pluggable".

    $ sudo pacman -Syu kanshi

  Now I need to configure it and get my Sway config to interact with it.

  Can be run as a Systemd User daemon whenever swaywm is running.

    See:
      https://wiki.archlinux.org/title/sway
      https://www.reddit.com/r/swaywm/comments/g4vzrq/does_anyone_use_kanshi

2023-02-09:
  Continue Kanshi config.  From https://wiki.archlinux.org/title/sway they
  use Kanshi as an example of starting and stopping systemd services when
  sway starts and stops.

  I am adding these configuration to my dotfiles repo, but I'll write it
  up as if I am working directly on euler7.

  Create ~/.config/systemd/user/sway-session.target with the content

    [Unit]
    Description=Sway compositor seesion
    Documentation=man:systemd.special
    BindsTo=graphical-session.target
    Wants=graphical-session-pre.target
    After=graphical-session-pre.target

  Edit ~/.config/sway/config adding

    exec "systemctl --user import-environment; systemctl --user start sway-session.target"

  to the ## Output configuration section.  Example used exec-always, but I think
  exec is more appropriate.

  We need to link the kanshi service to sway-session.target, so
  create ~/.config/systemd/user/kanshi.service

    [Unit]
    Description=Dynamic output configuratin for Wayland compositors
    Documentation=https://sr.ht/~emerson/kanshi
    BindsTo=sway-session.target

    [Service]
    Type=simple
    ExecStart=/usr/bin/kanshi

    [Install]
    WantedBy=sway-session.target

  Finally, make sure, even if empty, a kanshi config file exists

    $ mkdir ~/.config/kanshi/config

  Kanshi will add new entries to this config which I can modify.  Not sure
  yet how I will handle sway integration and dotfiles management of this file.

  Reboot,

    $ systemctl --user status kanshi.service
    ○ kanshi.service - Dynamic output configuratin for Wayland compositors
         Loaded: loaded (/home/grs/.config/systemd/user/kanshi.service; disabled; preset: enabled)
         Active: inactive (dead)
           Docs: https://sr.ht/~emerson/kanshi

  Will repeat on gauss17, need to get to bottom of why service did not start.

2023-02-10:
  Let's get to the bottom of why Kanshi (Himself) is not loading.

    $ systemctl status graphical.target
    ● graphical.target - Graphical Interface
         Loaded: loaded (/usr/lib/systemd/system/graphical.target; static)
         Active: active since Fri 2023-02-10 09:05:40 MST; 4h 33min ago
          Until: Fri 2023-02-10 09:05:40 MST; 4h 33min ago
           Docs: man:systemd.special(7)

    $ systemctl --user status sway-session.target
    ● sway-session.target - Sway compositor session
         Loaded: loaded (/home/grs/.config/systemd/user/sway-session.target; static)
         Active: active since Fri 2023-02-10 11:08:59 MST; 2h 33min ago
          Until: Fri 2023-02-10 11:08:59 MST; 2h 33min ago
           Docs: man:systemd.special

    $ systemctl --user status kanshi.service
    ○ kanshi.service - Dynamic output configuration for Wayland compositors
         Loaded: loaded (/home/grs/.config/systemd/user/kanshi.service; disabled; preset: enabled)
         Active: inactive (dead)
           Docs: https://sr.ht/~emerson/kanshi

  From redhat.com Systemd documentation

     basic       unit target covering basic boot-up
     rescue      unit target that pulls in the base system and spawns a rescue shell
     multi-user  unit target for setting up a multi-user system
     graphical   unit target for setting up a graphical login screen
     emergency   unit target that starts an emergency shell on the main console
     sysinit     unit target that pulls in the services required for system initializatio

  I am not using a display manager.  Sway does not even officially support
  display managers, though most work with it.

  But above status shows that graphical.target was reached 2 hours before
  I even started Sway.
    
  Found these repos that might be useful:

    https://github.com/alebastr/sway-systemd
    https://github.com/alebastr/dotfiles
    https://gitlab.com/fedora/sigs/sway/sway-config-fedora

  Aside: might also want to look into mako, a lightweight notification daemon
  for Wayland.  Works on Sway.  Packman package already installed in euler7.
