#!/bin/bash
#
# Trims off duplicate and non-existant directories
# for colen separated lists of $PATH components.
#
# Useful when:
#   - .bash_profile gets resourced
#   -  user's home directory is shared between many systems
#   -  user uses same .bash_profile between various systems
#
# Usage: pathTrim /first/path/component:/second/path/coponent:.
#

unset Fields Path Dir

# Standarize the $PATH list:
#   - remove redundant / and :
#   - remove trailing /'s on directory names
#   - /./ -> / 
#
sedScript='s!/+!/!g
           s!:+!:!g
           s!/:!:!g
           s!/\./!/!g'
Path=$(command -p sed -E -e"$sedScript" <(echo -n "$@"))

# Search for duplicates and add entries for only dirctories that exist
OLDIFS=$IFS; IFS=':'
for Dir in $Path
do
    if [[ -d "$Dir" ]]
    then
        for Field in "${Fields[@]}"
        do
            [[ $Field == "$Dir" ]] && continue 2
        done
        Fields+=("$Dir")
    fi
done
IFS=$OLDIFS

# Construct new path string and send to stdout
Path=
for Field in "${Fields[@]}"  # Create PATH string from array
do
    Path+=${Field}:
done
echo "${Path%:}"  # Remove final :
